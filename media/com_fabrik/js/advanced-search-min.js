Fabrik.AdvancedSearch=new Class({Implements:[Options,Events],options:{},initialize:function(a){this.setOptions(a);this.trs=$A([]);if($("advanced-search-add")){$("advanced-search-add").addEvent("click",this.addRow.bindWithEvent(this));$("advancedFilterTable-clearall").addEvent("click",this.resetForm.bindWithEvent(this));this.trs.each(function(b){b.inject($("advanced-search-table").getElements("tr").getLast(),"after");Fabrik.AdvancedSearch=new Class({Implements:[Options,Events],options:{},initialize:function(c){this.setOptions(c);this.trs=$A([]);if($("advanced-search-add")){$("advanced-search-add").addEvent("click",this.addRow.bindWithEvent(this));$("advancedFilterTable-clearall").addEvent("click",this.resetForm.bindWithEvent(this));this.trs.each(function(d){d.inject($("advanced-search-table").getElements("tr").getLast(),"after")}.bind(this))}this.watchDelete();this.watchElementList()},watchDelete:function(){$$(".advanced-search-remove-row").removeEvents();$$(".advanced-search-remove-row").addEvent("click",this.removeRow.bindWithEvent(this))},watchElementList:function(){$$("select.key").removeEvents();$$("select.key").addEvent("change",this.updateValueInput.bindWithEvent(this))},updateValueInput:function(g){g.stop();var c=g.target.get("value");var h=g.target.getParent().getParent().getElements("td")[3];if(c===""){h.set("html","");return}var d=Fabrik.liveSite+"index.php?option=com_fabrik&task=list.elementFilter&format=raw";var f=this.options.elementMap[c];new Request.HTML({url:d,update:h,data:{element:c,id:this.options.listid,elid:f.id,plugin:f.plugin,counter:this.options.counter}}).send()},addRow:function(f){this.options.counter++;f.stop();var d=$("advanced-search-table").getElement("tbody").getElements("tr").getLast();var g=d.clone();g.inject(d,"after");g.getElement("td").empty().set("html",this.options.conditionList);var c=g.getElements("td");c[1].empty().set("html",this.options.elementList);c[1].adopt([new Element("input",{type:"hidden",name:"fabrik___filter[list_"+this.options.listid+"][search_type][]",value:"advanced"}),new Element("input",{type:"hidden",name:"fabrik___filter[list_"+this.options.listid+"][grouped_to_previous][]",value:"0"})]);c[2].empty().set("html",this.options.statementList);c[3].empty();this.watchDelete();this.watchElementList()},removeRow:function(d){var g=new Event(d);g.stop();if($$(".advanced-search-remove-row").length>1){this.options.counter--;var f=g.target.findUp("tr");var c=new Fx.Morph(f,{duration:800,transition:Fx.Transitions.Quart.easeOut,onComplete:function(){f.dispose()}});c.start({height:0,opacity:0})}},resetForm:function(){var c=$("advanced-search-table");if(!c){return}$("advanced-search-table").getElements("tbody tr").each(function(e,d){if(d>1){e.dispose()}if(d===0){e.getElements(".inputbox").each(function(f){f.selectedIndex=0});e.getElements("input").each(function(f){f.value=""})}});this.watchDelete();this.watchElementList()},deleteFilterOption:function(h){var f=new Event(h);var c=f.target;$(c.id).removeEvent("click",this.deleteFilterOption.bindWithEvent(this));var g=c.parentNode.parentNode;var d=g.parentNode;d.removeChild(g);f.stop()}})}.bind(this))}this.watchDelete();this.watchElementList()},watchDelete:function(){$$(".advanced-search-remove-row").removeEvents();$$(".advanced-search-remove-row").addEvent("click",this.removeRow.bindWithEvent(this))},watchElementList:function(){$$("select.key").removeEvents();$$("select.key").addEvent("change",this.updateValueInput.bindWithEvent(this))},updateValueInput:function(d){d.stop();var a=d.target.get("value");var f=d.target.getParent().getParent().getElements("td")[3];if(a===""){f.set("html","");return}var b=Fabrik.liveSite+"index.php?option=com_fabrik&task=list.elementFilter&format=raw";var c=this.options.elementMap[a];new Request.HTML({url:b,update:f,data:{element:a,id:this.options.listid,elid:c.id,plugin:c.plugin,counter:this.options.counter}}).send()},addRow:function(c){this.options.counter++;c.stop();var b=$("advanced-search-table").getElement("tbody").getElements("tr").getLast();var d=b.clone();d.inject(b,"after");d.getElement("td").empty().set("html",this.options.conditionList);var a=d.getElements("td");a[1].empty().set("html",this.options.elementList);a[1].adopt([new Element("input",{type:"hidden",name:"fabrik___filter[list_"+this.options.listid+"][search_type][]",value:"advanced"}),new Element("input",{type:"hidden",name:"fabrik___filter[list_"+this.options.listid+"][grouped_to_previous][]",value:"0"})]);a[2].empty().set("html",this.options.statementList);a[3].empty();this.watchDelete();this.watchElementList()},removeRow:function(b){var d=new Event(b);d.stop();if($$(".advanced-search-remove-row").length>1){this.options.counter--;var c=d.target.findUp("tr");var a=new Fx.Morph(c,{duration:800,transition:Fx.Transitions.Quart.easeOut,onComplete:function(){c.dispose()}});a.start({height:0,opacity:0})}},resetForm:function(){var a=$("advanced-search-table");if(!a){return}$("advanced-search-table").getElements("tbody tr").each(function(c,b){if(b>1){c.dispose()}if(b===0){c.getElements(".inputbox").each(function(d){d.selectedIndex=0});c.getElements("input").each(function(d){d.value=""})}});this.watchDelete();this.watchElementList()},deleteFilterOption:function(f){var c=new Event(f);var a=c.target;$(a.id).removeEvent("click",this.deleteFilterOption.bindWithEvent(this));var d=a.parentNode.parentNode;var b=d.parentNode;b.removeChild(d);c.stop()}});