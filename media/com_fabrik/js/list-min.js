var FbListPlugin=new Class({Implements:[Events,Options],options:{requireChecked:true},initialize:function(b){this.setOptions(b);this.result=true;head.ready(function(){this.listform=this.getList().getForm();var d=this.listform.getElement("input[name=listid]");if(typeOf(d)==="null"){return}this.listid=d.value;this.watchButton()}.bind(this))},getList:function(){return Fabrik.blocks["list_"+this.options.ref]},clearFilter:Function.from(),watchButton:function(){if(typeOf(this.options.name)==="null"){return}document.addEvent("click:relay(."+this.options.name+")",function(d){d.stop();var f,h;if(d.target.getParent(".fabrik_row")){f=d.target.getParent(".fabrik_row");if(f.getElement("input[name^=ids]")){h=f.getElement("input[name^=ids]");this.listform.getElements("input[name^=ids]").set("checked",false);h.set("checked",true)}}var b=false;this.listform.getElements("input[name^=ids]").each(function(e){if(e.checked){b=true}});f=d.target.getParent(".fabrik___heading");if(f&&b===false){this.listform.getElements("input[name^=ids]").set("checked",true);this.listform.getElement("input[name=checkAll]").set("checked",true);b=true}if(!b&&this.options.requireChecked){alert(Joomla.JText._("COM_FABRIK_PLEASE_SELECT_A_ROW"));return}var g=this.options.name.split("-");this.listform.getElement("input[name=fabrik_listplugin_name]").value=g[0];this.listform.getElement("input[name=fabrik_listplugin_renderOrder]").value=g.getLast();this.buttonAction()}.bind(this))},buttonAction:function(){this.list.submit("doPlugin")}});var FbListFilter=new Class({Implements:[Options,Events],options:{container:"",type:"list",id:"",advancedSearch:{}},initialize:function(e){this.filters=$H({});this.setOptions(e);this.container=document.id(this.options.container);this.filterContainer=this.container.getElement(".fabrikFilterContainer");var d=this.container.getElement(".toggleFilters");if(typeOf(d)!=="null"){d.addEvent("click",function(h){var k=d.getPosition();h.stop();var b=k.x-this.filterContainer.getWidth();var l=k.y+d.getHeight();var g=this.filterContainer.getStyle("display")==="none"?this.filterContainer.show():this.filterContainer.hide();this.filterContainer.fade("toggle");this.container.getElements(".filter").toggle()}.bind(this));if(typeOf(this.filterContainer)!=="null"){this.filterContainer.fade("hide").hide();this.container.getElements(".filter").toggle()}}if(typeOf(this.container)==="null"){return}this.getList();var f=this.container.getElement(".clearFilters");if(typeOf(f)!=="null"){f.removeEvents();f.addEvent("click",function(b){b.stop();this.container.getElements(".fabrik_filter").each(function(g){if(g.get("tag")==="select"){g.selectedIndex=0}else{g.value=""}});this.getList().plugins.each(function(g){g.clearFilter()});new Element("input",{name:"resetfilters",value:1,type:"hidden"}).inject(this.container);if(this.options.type==="list"){this.list.submit("list.clearfilter")}else{this.container.getElement("form[name=filter]").submit()}}.bind(this))}if(advancedSearch=this.container.getElement(".advanced-search-link")){advancedSearch.addEvent("click",function(h){h.stop();var g=Fabrik.liveSite+"index.php?option=com_fabrik&view=list&tmpl=component&layout=_advancedsearch&listid="+this.options.id;this.windowopts={id:"advanced-search-win",title:Joomla.JText._("COM_FABRIK_ADVANCED_SEARCH"),loadMethod:"xhr",evalScripts:true,contentURL:g,width:690,height:300,y:this.options.popwiny,onContentLoaded:function(k){new AdvancedSearch(this.options.advancedSearch)}.bind(this)};var b=Fabrik.getWindow(this.windowopts)}.bind(this))}},getList:function(){this.list=Fabrik.blocks[this.options.type+"_"+this.options.ref];return this.list},addFilter:function(b,d){if(this.filters.has(b)===false){this.filters.set(b,[])}this.filters.get(b).push(d)},getFilterData:function(){var b={};this.container.getElements(".fabrik_filter").each(function(e){if(e.id.test(/value$/)){var d=e.id.match(/(\S+)value$/)[1];if(e.get("tag")==="select"&&e.selectedIndex!==-1){b[d]=document.id(e.options[e.selectedIndex]).get("text")}else{b[d]=e.get("value")}b[d+"_raw"]=e.get("value")}}.bind(this));return b},update:function(){this.filters.each(function(b,d){b.each(function(e){e.update()}.bind(this))}.bind(this))}});var FbList=new Class({Implements:[Options,Events],options:{admin:false,filterMethod:"onchange",ajax:false,ajax_links:false,links:{edit:"",detail:"",add:""},form:"listform_"+this.id,hightLight:"#ccffff",primaryKey:"",headings:[],labels:{},Itemid:0,formid:0,canEdit:true,canView:true,page:"index.php",actionMethod:"",formels:[],data:[],rowtemplate:"",floatPos:"left",csvChoose:false,csvOpts:{}},initialize:function(d,b){this.id=d;this.setOptions(b);this.getForm();this.list=document.id("list_"+this.id);this.actionManager=new FbListActions(this,{method:this.options.actionMethod,floatPos:this.options.floatPos});new FbGroupedToggler(this.form);new FbListKeys(this);if(this.list){this.tbody=this.list.getElement("tbody");if(typeOf(this.tbody)==="null"){this.tbody=this.list}if(window.ie){this.options.rowtemplate=this.list.getElement(".fabrik_row")}}this.watchAll(false);Fabrik.addEvent("fabrik.form.submitted",function(){this.updateRows()}.bind(this))},setRowTemplate:function(){if(typeOf(this.options.rowtemplate)==="string"){var b=this.list.getElement(".fabrik_row");if(window.ie&&typeOf(b)!=="null"){this.options.rowtemplate=b}}},watchAll:function(b){b=b?b:false;this.watchNav();if(!b){this.watchRows()}this.watchFilters();this.watchOrder();this.watchEmpty();this.watchButtons()},watchButtons:function(){this.exportWindowOpts={id:"exportcsv",title:"Export CSV",loadMethod:"html",minimizable:false,width:360,height:120,content:""};if(this.options.view==="csv"){this.openCSVWindow()}else{if(this.form.getElements(".csvExportButton")){this.form.getElements(".csvExportButton").each(function(d){if(d.hasClass("custom")===false){d.addEvent("click",function(b){this.openCSVWindow();b.stop()}.bind(this))}}.bind(this))}}},openCSVWindow:function(){var b=this.makeCSVExportForm();this.exportWindowOpts.content=b;this.exportWindowOpts.onContentLoaded=function(){this.fitToContent()};Fabrik.getWindow(this.exportWindowOpts)},makeCSVExportForm:function(){if(this.options.csvChoose){return this._csvExportForm()}else{return this._csvAutoStart()}},_csvAutoStart:function(){var b=new Element("div",{id:"csvmsg"}).set("html",Joomla.JText._("COM_FABRIK_LOADING")+' <br /><span id="csvcount">0</span> / <span id="csvtotal"></span> '+Joomla.JText._("COM_FABRIK_RECORDS")+".<br/>"+Joomla.JText._("COM_FABRIK_SAVING_TO")+'<span id="csvfile"></span>');this.csvopts=this.options.csvOpts;this.csvfields=this.options.csvFields;this.triggerCSVExport(-1);return b},_csvExportForm:function(){var o="<input type='radio' value='1' name='incfilters' checked='checked' />"+Joomla.JText._("JYES");var k="<input type='radio' value='1' name='incraw' checked='checked' />"+Joomla.JText._("JYES");var h="<input type='radio' value='1' name='inccalcs' checked='checked' />"+Joomla.JText._("JYES");var f="<input type='radio' value='1' name='inctabledata' checked='checked' />"+Joomla.JText._("JYES");var e="<input type='radio' value='1' name='excel' checked='checked' />Excel CSV";var b="index.php?option=com_fabrik&view=list&listid="+this.id+"&format=csv&Itemid="+this.options.Itemid;var d={styles:{width:"200px","float":"left"}};var n=new Element("form",{action:b,method:"post"}).adopt([new Element("div",d).set("text",Joomla.JText._("COM_FABRIK_FILE_TYPE")),new Element("label").set("html",e),new Element("label").adopt([new Element("input",{type:"radio",name:"excel",value:"0"}),new Element("span").set("text","CSV")]),new Element("br"),new Element("br"),new Element("div",d).appendText(Joomla.JText._("COM_FABRIK_INCLUDE_FILTERS")),new Element("label").set("html",o),new Element("label").adopt([new Element("input",{type:"radio",name:"incfilters",value:"0"}),new Element("span").set("text",Joomla.JText._("JNO"))]),new Element("br"),new Element("div",d).appendText(Joomla.JText._("COM_FABRIK_INCLUDE_DATA")),new Element("label").set("html",f),new Element("label").adopt([new Element("input",{type:"radio",name:"inctabledata",value:"0"}),new Element("span").set("text",Joomla.JText._("JNO"))]),new Element("br"),new Element("div",d).appendText(Joomla.JText._("COM_FABRIK_INCLUDE_RAW_DATA")),new Element("label").set("html",k),new Element("label").adopt([new Element("input",{type:"radio",name:"incraw",value:"0"}),new Element("span").set("text",Joomla.JText._("JNO"))]),new Element("br"),new Element("div",d).appendText(Joomla.JText._("COM_FABRIK_INLCUDE_CALCULATIONS")),new Element("label").set("html",h),new Element("label").adopt([new Element("input",{type:"radio",name:"inccalcs",value:"0"}),new Element("span").set("text",Joomla.JText._("JNO"))])]);new Element("h4").set("text",Joomla.JText._("COM_FABRIK_SELECT_COLUMNS_TO_EXPORT")).inject(n);var m="";var l=0;$H(this.options.labels).each(function(q,p){if(p.substr(0,7)!=="fabrik_"&&p!=="____form_heading"){var s=p.split("___")[0];if(s!==m){m=s;new Element("h5").set("text",m).inject(n)}var g="<input type='radio' value='1' name='fields["+p+"]' checked='checked' />"+Joomla.JText._("JYES");q=q.replace(/<\/?[^>]+(>|$)/g,"");var t=new Element("div",d).appendText(q);t.inject(n);new Element("label").set("html",g).inject(n);new Element("label").adopt([new Element("input",{type:"radio",name:"fields["+p+"]",value:"0"}),new Element("span").appendText(Joomla.JText._("JNO"))]).inject(n);new Element("br").inject(n)}l++}.bind(this));if(this.options.formels.length>0){new Element("h5").set("text",Joomla.JText._("COM_FABRIK_FORM_FIELDS")).inject(n);this.options.formels.each(function(p){var g="<input type='radio' value='1' name='fields["+p.name+"]' checked='checked' />"+Joomla.JText._("JYES");var q=new Element("div",d).appendText(p.label);q.inject(n);new Element("label").set("html",g).inject(n);new Element("label").adopt([new Element("input",{type:"radio",name:"fields["+p.name+"]",value:"0"}),new Element("span").set("text",Joomla.JText._("JNO"))]).inject(n);new Element("br").inject(n)}.bind(this))}new Element("div",{styles:{"text-align":"right"}}).adopt(new Element("input",{type:"button",name:"submit",value:Joomla.JText._("COM_FABRIK_EXPORT"),"class":"button",events:{click:function(g){g.stop();g.target.disabled=true;new Element("div",{id:"csvmsg"}).set("html",Joomla.JText._("COM_FABRIK_LOADING")+' <br /><span id="csvcount">0</span> / <span id="csvtotal"></span> '+Joomla.JText._("COM_FABRIK_RECORDS")+".<br/>"+Joomla.JText._("COM_FABRIK_SAVING_TO")+'<span id="csvfile"></span>').inject(g.target,"before");this.triggerCSVExport(0)}.bind(this)}})).inject(n);new Element("input",{type:"hidden",name:"view",value:"table"}).inject(n);new Element("input",{type:"hidden",name:"option",value:"com_fabrik"}).inject(n);new Element("input",{type:"hidden",name:"listid",value:this.id}).inject(n);new Element("input",{type:"hidden",name:"format",value:"csv"}).inject(n);new Element("input",{type:"hidden",name:"c",value:"table"}).inject(n);return n},triggerCSVExport:function(f,d,b){if(f!==0){if(f===-1){f=0;d=this.csvopts;d.fields=this.csvfields}else{d=this.csvopts;b=this.csvfields}}else{if(!d){d={};if(typeOf(document.id("exportcsv"))!=="null"){$A(["incfilters","inctabledata","incraw","inccalcs","excel"]).each(function(h){var g=document.id("exportcsv").getElements("input[name="+h+"]");if(g.length>0){d[h]=g.filter(function(k){return k.checked})[0].value}})}}if(!b){b={};if(typeOf(document.id("exportcsv"))!=="null"){document.id("exportcsv").getElements("input[name^=field]").each(function(h){if(h.checked){var g=h.name.replace("fields[","").replace("]","");b[g]=h.get("value")}})}}d.fields=b;this.csvopts=d;this.csvfields=b}this.form.getElements(".fabrik_filter").each(function(g){d[g.name]=g.get("value")}.bind(this));d.start=f;d.option="com_fabrik";d.view="list";d.format="csv";d.Itemid=this.options.Itemid;d.listid=this.id;d.listref=this.id;var e=new Request.JSON({url:"",method:"post",data:d,onError:function(h,g){fconsole(h,g)},onSuccess:function(h){if(h.err){alert(h.err)}else{if(typeOf(document.id("csvcount"))!=="null"){document.id("csvcount").set("text",h.count)}if(typeOf(document.id("csvtotal"))!=="null"){document.id("csvtotal").set("text",h.total)}if(typeOf(document.id("csvfile"))!=="null"){document.id("csvfile").set("text",h.file)}if(h.count<h.total){this.triggerCSVExport(h.count)}else{var g=Fabrik.liveSite+"index.php?option=com_fabrik&view=list&format=csv&listid="+this.id+"&start="+h.count+"&Itemid="+this.options.Itemid;var k=Joomla.JText._("COM_FABRIK_CSV_COMPLETE");k+=' <a href="'+g+'">'+Joomla.JText._("COM_FABRIK_CSV_DOWNLOAD_HERE")+"</a>";if(typeOf(document.id("csvmsg"))!=="null"){document.id("csvmsg").set("html",k)}}}}.bind(this)});e.send()},addPlugins:function(b){b.each(function(d){d.list=this}.bind(this));this.plugins=b},watchEmpty:function(f){var d=document.id(this.options.form).getElement(".doempty",this.options.form);if(d){d.addEvent("click",function(b){b.stop();if(confirm(Joomla.JText._("COM_FABRIK_CONFIRM_DROP"))){this.submit("list.doempty")}}.bind(this))}},watchOrder:function(){var b=document.id(this.options.form).getElements(".fabrikorder, .fabrikorder-asc, .fabrikorder-desc");b.removeEvents("click");b.each(function(d){d.addEvent("click",function(g){var h="";var f="";d=document.id(g.target);var k=d.getParent(".fabrik_ordercell");if(d.tagName!=="a"){d=k.getElement("a")}switch(d.className){case"fabrikorder-asc":f="fabrikorder-desc";h="desc";break;case"fabrikorder-desc":f="fabrikorder";h="-";break;case"fabrikorder":f="fabrikorder-asc";h="asc";break}k=k.className.split(" ")[2].replace("_order","").replace(/^\s+/g,"").replace(/\s+$/g,"");d.className=f;this.fabrikNavOrder(k,h);g.stop()}.bind(this))}.bind(this))},watchFilters:function(){var d="";var b=document.id(this.options.form).getElement(".fabrik_filter_submit");document.id(this.options.form).getElements(".fabrik_filter").each(function(e){d=e.get("tag")==="select"?"change":"blur";if(this.options.filterMethod!=="submitform"){e.removeEvent(d);e.store("initialvalue",e.get("value"));e.addEvent(d,function(f){f.stop();if(f.target.retrieve("initialvalue")!==f.target.get("value")){this.submit("list.filter")}}.bind(this))}else{e.addEvent(d,function(f){b.highlight("#ffaa00")}.bind(this))}}.bind(this));if(this.options.filterMethod==="submitform"){if(b){b.removeEvents();b.addEvent("click",function(f){this.submit("list.filter")}.bind(this))}}document.id(this.options.form).getElements(".fabrik_filter").addEvent("keydown",function(f){if(f.code===13){f.stop();this.submit("list.filter")}}.bind(this))},setActive:function(b){this.list.getElements(".fabrik_row").each(function(d){d.removeClass("activeRow")});b.addClass("activeRow")},getActiveRow:function(b){var d=b.target.getParent(".fabrik_row");if(!d){d=this.activeRow}return d},watchRows:function(){if(!this.list){return}if(this.options.ajax_links){document.addEvent("click:relay(.fabrik_edit)",function(h){h.stop();var k=this.getActiveRow(h);var f,d,b;if(!k){return}this.setActive(k);var g=k.id.replace("list_"+this.id+"_row_","");if(this.options.links.edit===""){f=Fabrik.liveSite+"index.php?option=com_fabrik&view=form&formid="+this.options.formid+"&rowid="+g+"&tmpl=component&ajax=1";d="xhr"}else{if(h.target.get("tag")==="a"){b=h.target}else{b=typeOf(h.target.getElement("a"))!=="null"?h.target.getElement("a"):h.target.getParent("a")}f=b.get("href");d="iframe"}Fabrik.getWindow({id:"add."+this.options.formid,title:"Edit",loadMethod:d,contentURL:f})}.bind(this));document.addEvent("click:relay(.fabrik_view)",function(g){g.stop();var h=this.getActiveRow(g);var d,b;if(!h){return}this.setActive(h);var f=h.id.replace("list_"+this.id+"_row_","");if(this.options.links.detail===""){d=Fabrik.liveSite+"index.php?option=com_fabrik&view=details&formid="+this.options.formid+"&rowid="+f+"&tmpl=component&ajax=1";b="xhr"}else{if(g.target.get("tag")==="a"){a=g.target}else{a=typeOf(g.target.getElement("a"))!=="null"?g.target.getElement("a"):g.target.getParent("a")}d=a.get("href");b="iframe"}Fabrik.getWindow({id:"view.."+this.options.formid+"."+f,title:"Details",loadMethod:b,contentURL:d})}.bind(this))}},getForm:function(){if(!this.form){this.form=document.id(this.options.form)}return this.form},submit:function(b){this.getForm();if(b==="list.delete"){var d=false;this.form.getElements("input[name^=ids]").each(function(e){if(e.checked){d=true}});if(!d){alert(Joomla.JText._("COM_FABRIK_SELECT_ROWS_FOR_DELETION"));Fabrik.loader.stop("listform_"+this.id);return false}if(!confirm(Joomla.JText._("COM_FABRIK_CONFIRM_DELETE"))){Fabrik.loader.stop("listform_"+this.id);return false}}Fabrik.loader.start("listform_"+this.id);if(b==="list.filter"){this.form.task.value=b;if(this.form["limitstart"+this.id]){this.form.getElement("#limitstart"+this.id).value=0}}else{if(b!==""){this.form.task.value=b}}if(this.options.ajax){this.form.getElement("input[name=option]").value="com_fabrik";this.form.getElement("input[name=view]").value="list";this.form.getElement("input[name=format]").value="raw";if(!this.request){this.request=new Request({url:this.form.get("action"),data:this.form,onComplete:function(e){e=JSON.decode(e);this._updateRows(e);Fabrik.loader.stop("listform_"+this.id)}.bind(this)})}this.request.send();Fabrik.fireEvent("fabrik.list.submit",[b,this.form.toQueryString().toObject()])}else{this.form.submit();Fabrik.loader.stop("listform_"+this.id)}return false},fabrikNav:function(b){this.options.limitStart=b;this.form.getElement("#limitstart"+this.id).value=b;Fabrik.fireEvent("fabrik.list.navigate",[this,b]);if(!this.result){this.result=true;return false}this.submit("list.view");return false},fabrikNavOrder:function(b,d){this.form.orderby.value=b;this.form.orderdir.value=d;Fabrik.fireEvent("fabrik.list.order",[this,b,d]);if(!this.result){this.result=true;return false}this.submit("list.order")},removeRows:function(d){for(i=0;i<d.length;i++){var e=document.id("list_"+this.id+"_row_"+d[i]);var b=new Fx.Morph(e,{duration:1000});b.start({backgroundColor:this.options.hightLight}).chain(function(){this.start({opacity:0})}).chain(function(){e.dispose();this.checkEmpty()}.bind(this))}},editRow:function(){},clearRows:function(){this.list.getElements(".fabrik_row").each(function(b){b.dispose()})},updateRows:function(){var d={option:"com_fabrik",view:"list",task:"list.view",format:"raw",listid:this.id};var b="";d["limit"+this.id]=this.options.limitLength;new Request.JSON({url:b,data:d,onSuccess:function(e){this._updateRows(e)}.bind(this)}).send()},_updateRows:function(f){if(f.id===this.id&&f.model==="list"){var g=document.id(this.options.form).getElements(".fabrik___heading").getLast();var o=new Hash(f.headings);o.each(function(r,p){p="."+p;try{if(typeOf(g.getElement(p))!=="null"){g.getElement(p).getElement("span").set("html",r)}}catch(q){fconsole(q)}});this.clearRows();var b=0;var m=0;trs=[];this.options.data=f.data;if(f.calculations){this.updateCals(f.calculations)}if(typeOf(this.form.getElement(".fabrikNav"))!=="null"){this.form.getElement(".fabrikNav").set("html",f.htmlnav)}this.setRowTemplate();var h=this.options.isGrouped?$H(f.data):f.data;var n=0;h.each(function(t,q){var p,v;var s=this.options.isGrouped?this.list.getElements(".fabrik_groupdata")[n]:this.tbody;n++;for(i=0;i<t.length;i++){if(typeOf(this.options.rowtemplate)==="string"){p=(!this.options.rowtemplate.match(/<tr/))?"div":"table";v=new Element(p);v.set("html",this.options.rowtemplate)}else{p=this.options.rowtemplate.get("tag")==="tr"?"table":"div";v=new Element(p);v.adopt(this.options.rowtemplate.clone())}var w=$H(t[i]);$H(w.data).each(function(A,z){var y="."+z;var r=v.getElement(y);if(typeOf(r)!=="null"){r.set("html",A)}m++}.bind(this));v.getElement(".fabrik_row").id=w.id;if(typeOf(this.options.rowtemplate)==="string"){var x=v.getElement(".fabrik_row").clone();x.id=w.id;x.inject(s)}else{var u=v.getElement(".fabrik_row");u.inject(s);v.empty()}b++}}.bind(this));var d=this.list.getParent(".fabrikDataContainer");var l=this.list.getParent(".fabrikForm").getElement(".emptyDataMessage");if(m===0){if(typeOf(l)!=="null"){l.setStyle("display","")}}else{if(typeOf(d)!=="null"){d.setStyle("display","")}if(typeOf(l)!=="null"){l.setStyle("display","none")}}if(typeOf(this.form.getElement(".fabrikNav"))!=="null"){this.form.getElement(".fabrikNav").set("html",f.htmlnav)}this.watchAll(true);Fabrik.fireEvent("fabrik.list.updaterows");try{Slimbox.scanPage()}catch(e){fconsole("slimbox scan:"+e)}try{Mediabox.scanPage()}catch(k){fconsole("mediabox scan:"+k)}Fabrik.fireEvent("fabrik.list.update",[this,f])}this.stripe();Fabrik.loader.stop("listform_"+this.id)},addRow:function(f){var e=new Element("tr",{"class":"oddRow1"});var b={test:"hi"};for(var d in f){if(this.options.headings.indexOf(d)!==-1){var g=new Element("td",{}).appendText(f[d]);e.appendChild(g)}}e.inject(this.tbody)},addRows:function(b){for(i=0;i<b.length;i++){for(j=0;j<b[i].length;j++){this.addRow(b[i][j])}}this.stripe()},stripe:function(){var b=this.list.getElements(".fabrik_row");for(i=0;i<b.length;i++){if(i!==0){var d="oddRow"+(i%2);b[i].addClass(d)}}},checkEmpty:function(){var b=this.list.getElements("tr");if(b.length===2){this.addRow({label:Joomla.JText._("COM_FABRIK_NO_RECORDS")})}},watchCheckAll:function(d){var b=this.form.getElement("input[name=checkAll]");if(typeOf(b)!=="null"){b.addEvent("click",function(k){var h=this.list.getParent(".fabrikList")?this.list.getParent(".fabrikList"):this.list;var g=h.getElements("input[name^=ids]");c=!k.target.checked?"":"checked";for(var f=0;f<g.length;f++){g[f].checked=c;this.toggleJoinKeysChx(g[f])}}.bind(this))}this.form.getElements("input[name^=ids]").each(function(e){e.addEvent("change",function(f){this.toggleJoinKeysChx(e)}.bind(this))}.bind(this))},toggleJoinKeysChx:function(b){b.getParent().getElements("input[class=fabrik_joinedkey]").each(function(d){d.checked=b.checked})},watchNav:function(h){var g=this.form.getElement("select[name*=limit]");if(g){g.addEvent("change",function(l){var k=Fabrik.fireEvent("fabrik.list.limit",[this]);if(this.result===false){this.result=true;return false}this.submit("list.filter")}.bind(this))}var d=this.form.getElement(".addRecord");if(typeOf(d)!=="null"&&(this.options.ajax_links)){d.removeEvents();var f=(this.options.links.add===""||d.href.contains(Fabrik.liveSite))?"xhr":"iframe";d.addEvent("click",function(k){k.stop();Fabrik.getWindow({id:"add-"+this.id,title:"Add",loadMethod:f,contentURL:d.href})}.bind(this))}var b=document.getElements(".fabrik_delete a");document.addEvent("click:relay(.fabrik_delete a)",function(l){var k=l.target.getParent(".fabrik_row");if(!k){k=this.activeRow}if(k){var m=k.getElement("input[type=checkbox][name*=id]");if(typeOf(m)!=="null"){m.checked=true}}else{if(this.options.actionMethod!==""){this.form.getElements("input[type=checkbox][name*=id], input[type=checkbox][name=checkAll]").each(function(e){e.checked=true})}}if(!this.submit("list.delete")){l.stop()}}.bind(this));if(document.id("fabrik__swaptable")){document.id("fabrik__swaptable").addEvent("change",function(k){window.location="index.php?option=com_fabrik&task=list.view&cid="+k.target.get("value")}.bind(this))}if(this.options.ajax){if(typeOf(this.form.getElement(".pagination"))!=="null"){this.form.getElement(".pagination").getElements(".pagenav").each(function(e){e.addEvent("click",function(k){k.stop();if(e.get("tag")==="a"){var l=e.href.toObject();this.fabrikNav(l["limitstart"+this.id])}}.bind(this))}.bind(this))}}this.watchCheckAll()},updateCals:function(d){var b=["sums","avgs","count","medians"];this.form.getElements(".fabrik_calculations").each(function(e){b.each(function(f){$H(d[f]).each(function(k,g){var h=e.getElement(".fabrik_row___"+g);if(typeOf(h)!=="null"){h.set("html",k)}})})})}});var FbListKeys=new Class({initialize:function(b){window.addEvent("keyup",function(f){if(f.alt){switch(f.key){case Joomla.JText._("COM_FABRIK_LIST_SHORTCUTS_ADD"):var d=b.form.getElement(".addRecord");if(b.options.ajax){d.fireEvent("click")}if(d.getElement("a")){b.options.ajax?d.getElement("a").fireEvent("click"):document.location=d.getElement("a").get("href")}else{if(!b.options.ajax){document.location=d.get("href")}}break;case Joomla.JText._("COM_FABRIK_LIST_SHORTCUTS_EDIT"):fconsole("edit");break;case Joomla.JText._("COM_FABRIK_LIST_SHORTCUTS_DELETE"):fconsole("delete");break;case Joomla.JText._("COM_FABRIK_LIST_SHORTCUTS_FILTER"):fconsole("filter");break}}}.bind(this))}});var FbGroupedToggler=new Class({initialize:function(b){b.addEvent("click:relay(.fabrik_groupheading a.toggle)",function(l){l.stop();var f=l.target.getParent(".fabrik_groupheading");var d=f.getElement("img");var k=d.retrieve("showgroup",true);var g=f.getParent().getNext();k?g.hide():g.show();if(k){d.src=d.src.replace("orderasc","orderneutral")}else{d.src=d.src.replace("orderneutral","orderasc")}k=k?false:true;d.store("showgroup",k)})}});var FbListActions=new Class({Implements:[Options],options:{method:"",floatPos:"bottom"},initialize:function(d,b){this.setOptions(b);this.list=d;this.actions=[];this.setUpSubMenus();Fabrik.addEvent("fabrik.list.update",function(f,e){this.observe()}.bind(this));this.observe()},observe:function(){if(this.options.method==="floating"){this.setUpFloating()}else{this.setUpDefault()}},setUpSubMenus:function(){if(!this.list.form){return}this.actions=this.list.form.getElements("ul.fabrik_action");this.actions.each(function(d){if(d.getElement("ul")){var e=d.getElement("ul");var g=e.clone();var b=e.getParent();var f=new FloatingTips(b,{showOn:"click",position:"bottom",html:true,content:g});e.dispose()}})},setUpDefault:function(){this.actions=this.list.form.getElements("ul.fabrik_action");this.actions.each(function(b){if(b.getParent().hasClass("fabrik_buttons")){return}b.fade(0.6);var d=b.getParent(".fabrik_row")?b.getParent(".fabrik_row"):b.getParent(".fabrik___heading");if(d){d.addEvents({mouseenter:function(f){b.fade(0.99)},mouseleave:function(f){b.fade(0.6)}})}})},setUpFloating:function(){this.list.form.getElements("ul.fabrik_action").each(function(k){if(k.getParent(".fabrik_row")){if(i=k.getParent(".fabrik_row").getElement("input[type=checkbox]")){var n=function(q,p,r){if(!q.target.checked){this.hide(q,p)}if(r==="tip"){}};var l=function(p){if(p.target.checked){this.show(p.target)}};var o=function(p,q){this.activeRow=k.getParent(".fabrik_row");return k.getParent()}.bind(this.list);var m=new FloatingTips(i,{position:this.options.floatPos,html:true,showOn:"click",hideOn:"click",content:o,hideFn:n,showFn:l})}}}.bind(this));var g=this.list.form.getElement("input[name=checkAll]");var h=function(k){return k.getParent(".fabrik___heading").getElement("ul.fabrik_action")};var f=function(l,k){if(!l.target.checked){this.hide(l,k)}};var d=function(k){if(k.target.checked){this.show(k.target)}};var e=new FloatingTips(g,{position:this.options.floatPos,html:true,showOn:"click",hideOn:"click",content:h,hideFn:f,showFn:d});if(this.list.list.getElements(".fabrik_actions")){this.list.list.getElements(".fabrik_actions").hide()}if(this.list.list.getElements(".fabrik_calculation")){var b=this.list.list.getElements(".fabrik_calculation").getLast();if(typeOf(b)!=="null"){b.hide()}}}});