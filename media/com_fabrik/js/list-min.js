var FbListPlugin=new Class({Implements:[Events,Options],options:{requireChecked:true},initialize:function(a){this.setOptions(a);this.result=true;head.ready(function(){this.listform=this.getList().getForm();var a=this.listform.getElement("input[name=listid]");if(typeOf(a)==="null"){return}this.listid=a.value;this.watchButton()}.bind(this))},getList:function(){return Fabrik.blocks["list_"+this.options.ref]},getRowId:function(a){if(!a.hasClass("fabrik_row")){a=a.getParent(".fabrik_row")}return a.id.split("_").getLast()},clearFilter:Function.from(),watchButton:function(){if(typeOf(this.options.name)==="null"){return}document.addEvent("click:relay(."+this.options.name+")",function(a){a.stop();var b,c;if(a.target.getParent(".fabrik_row")){b=a.target.getParent(".fabrik_row");if(b.getElement("input[name^=ids]")){c=b.getElement("input[name^=ids]");this.listform.getElements("input[name^=ids]").set("checked",false);c.set("checked",true)}}var d=false;this.listform.getElements("input[name^=ids]").each(function(a){if(a.checked){d=true}});b=a.target.getParent(".fabrik___heading");if(b&&d===false){this.listform.getElements("input[name^=ids]").set("checked",true);var e=this.listform.getElement("input[name=checkAll]");if(typeOf(e)!=="null"){e.set("checked",true)}d=true}if(!d&&this.options.requireChecked){alert(Joomla.JText._("COM_FABRIK_PLEASE_SELECT_A_ROW"));return}var f=this.options.name.split("-");this.listform.getElement("input[name=fabrik_listplugin_name]").value=f[0];this.listform.getElement("input[name=fabrik_listplugin_renderOrder]").value=f.getLast();this.buttonAction()}.bind(this))},buttonAction:function(){this.list.submit("list.doPlugin")}});var FbListFilter=new Class({Implements:[Options,Events],options:{container:"",type:"list",id:"",advancedSearch:{}},initialize:function(a){this.filters=$H({});this.setOptions(a);this.advancedSearch=false;this.container=document.id(this.options.container);this.filterContainer=this.container.getElement(".fabrikFilterContainer");var b=this.container.getElement(".toggleFilters");if(typeOf(b)!=="null"){b.addEvent("click",function(a){var c=b.getPosition();a.stop();var d=c.x-this.filterContainer.getWidth();var e=c.y+b.getHeight();var f=this.filterContainer.getStyle("display")==="none"?this.filterContainer.show():this.filterContainer.hide();this.filterContainer.fade("toggle");this.container.getElements(".filter, .listfilter").toggle()}.bind(this));if(typeOf(this.filterContainer)!=="null"){this.filterContainer.fade("hide").hide();this.container.getElements(".filter, .listfilter").toggle()}}if(typeOf(this.container)==="null"){return}this.getList();var c=this.container.getElement(".clearFilters");if(typeOf(c)!=="null"){c.removeEvents();c.addEvent("click",function(a){a.stop();this.container.getElements(".fabrik_filter").each(function(a){if(a.get("tag")==="select"){a.selectedIndex=0}else{a.value=""}});this.getList().plugins.each(function(a){a.clearFilter()});(new Element("input",{name:"resetfilters",value:1,type:"hidden"})).inject(this.container);if(this.options.type==="list"){this.list.submit("list.clearfilter")}else{this.container.getElement("form[name=filter]").submit()}}.bind(this))}if(advancedSearchButton=this.container.getElement(".advanced-search-link")){advancedSearchButton.addEvent("click",function(a){a.stop();var b=Fabrik.liveSite+"index.php?option=com_fabrik&view=list&tmpl=component&layout=_advancedsearch&listid="+this.options.id;b+="&listref="+this.options.ref;this.windowopts={id:"advanced-search-win"+this.options.ref,title:Joomla.JText._("COM_FABRIK_ADVANCED_SEARCH"),loadMethod:"xhr",evalScripts:true,contentURL:b,width:690,height:300,y:this.options.popwiny,onContentLoaded:function(a){var b=Fabrik.blocks["list_"+this.options.ref];b.advancedSearch=new AdvancedSearch(this.options.advancedSearch)}.bind(this)};var c=Fabrik.getWindow(this.windowopts)}.bind(this))}},getList:function(){this.list=Fabrik.blocks[this.options.type+"_"+this.options.ref];return this.list},addFilter:function(a,b){if(this.filters.has(a)===false){this.filters.set(a,[])}this.filters.get(a).push(b)},onSubmit:function(){if(this.filters.date){this.filters.date.each(function(a){a.onSubmit()})}},onUpdateData:function(){if(this.filters.date){this.filters.date.each(function(a){a.onUpdateData()})}},getFilterData:function(){var a={};this.container.getElements(".fabrik_filter").each(function(b){if(b.id.test(/value$/)){var c=b.id.match(/(\S+)value$/)[1];if(b.get("tag")==="select"&&b.selectedIndex!==-1){a[c]=document.id(b.options[b.selectedIndex]).get("text")}else{a[c]=b.get("value")}a[c+"_raw"]=b.get("value")}}.bind(this));return a},update:function(){this.filters.each(function(a,b){a.each(function(a){a.update()}.bind(this))}.bind(this))}});var FbList=new Class({Implements:[Options,Events],options:{admin:false,filterMethod:"onchange",ajax:false,ajax_links:false,links:{edit:"",detail:"",add:""},form:"listform_"+this.id,hightLight:"#ccffff",primaryKey:"",headings:[],labels:{},Itemid:0,formid:0,canEdit:true,canView:true,page:"index.php",actionMethod:"",formels:[],data:[],rowtemplate:"",floatPos:"left",csvChoose:false,csvOpts:{},popup_width:300,popup_height:300,popup_offset_x:null,popup_offset_y:null,listRef:""},initialize:function(a,b){this.id=a;this.setOptions(b);this.getForm();this.result=true;this.plugins=[];this.list=document.id("list_"+this.options.listRef);this.actionManager=new FbListActions(this,{method:this.options.actionMethod,floatPos:this.options.floatPos});new FbGroupedToggler(this.form);new FbListKeys(this);if(this.list){this.tbody=this.list.getElement("tbody");if(typeOf(this.tbody)==="null"){this.tbody=this.list}if(window.ie){this.options.rowtemplate=this.list.getElement(".fabrik_row")}}this.watchAll(false);Fabrik.addEvent("fabrik.form.submitted",function(){this.updateRows()}.bind(this));Fabrik.addEvent("fabrik.form.ajax.submit.end",function(a){a.formElements.each(function(a){a.removeCustomEvents()});delete Fabrik.blocks["form_"+a.id]})},setRowTemplate:function(){if(typeOf(this.options.rowtemplate)==="string"){var a=this.list.getElement(".fabrik_row");if(window.ie&&typeOf(a)!=="null"){this.options.rowtemplate=a}}},watchAll:function(a){a=a?a:false;this.watchNav();if(!a){this.watchRows()}this.watchFilters();this.watchOrder();this.watchEmpty();this.watchButtons()},watchButtons:function(){this.exportWindowOpts={id:"exportcsv",title:"Export CSV",loadMethod:"html",minimizable:false,width:360,height:120,content:""};if(this.options.view==="csv"){this.openCSVWindow()}else{if(this.form.getElements(".csvExportButton")){this.form.getElements(".csvExportButton").each(function(a){if(a.hasClass("custom")===false){a.addEvent("click",function(a){this.openCSVWindow();a.stop()}.bind(this))}}.bind(this))}}},openCSVWindow:function(){var a=this.makeCSVExportForm();this.exportWindowOpts.content=a;this.exportWindowOpts.onContentLoaded=function(){this.fitToContent()};Fabrik.getWindow(this.exportWindowOpts)},makeCSVExportForm:function(){if(this.options.csvChoose){return this._csvExportForm()}else{return this._csvAutoStart()}},_csvAutoStart:function(){var a=(new Element("div",{id:"csvmsg"})).set("html",Joomla.JText._("COM_FABRIK_LOADING")+' <br /><span id="csvcount">0</span> / <span id="csvtotal"></span> '+Joomla.JText._("COM_FABRIK_RECORDS")+".<br/>"+Joomla.JText._("COM_FABRIK_SAVING_TO")+'<span id="csvfile"></span>');this.csvopts=this.options.csvOpts;this.csvfields=this.options.csvFields;this.triggerCSVExport(-1);return a},_csvExportForm:function(){var a="<input type='radio' value='1' name='incfilters' checked='checked' />"+Joomla.JText._("JYES");var b="<input type='radio' value='1' name='incraw' checked='checked' />"+Joomla.JText._("JYES");var c="<input type='radio' value='1' name='inccalcs' checked='checked' />"+Joomla.JText._("JYES");var d="<input type='radio' value='1' name='inctabledata' checked='checked' />"+Joomla.JText._("JYES");var e="<input type='radio' value='1' name='excel' checked='checked' />Excel CSV";var f="index.php?option=com_fabrik&view=list&listid="+this.id+"&format=csv&Itemid="+this.options.Itemid;var g={styles:{width:"200px","float":"left"}};var h=(new Element("form",{action:f,method:"post"})).adopt([(new Element("div",g)).set("text",Joomla.JText._("COM_FABRIK_FILE_TYPE")),(new Element("label")).set("html",e),(new Element("label")).adopt([new Element("input",{type:"radio",name:"excel",value:"0"}),(new Element("span")).set("text","CSV")]),new Element("br"),new Element("br"),(new Element("div",g)).appendText(Joomla.JText._("COM_FABRIK_INCLUDE_FILTERS")),(new Element("label")).set("html",a),(new Element("label")).adopt([new Element("input",{type:"radio",name:"incfilters",value:"0"}),(new Element("span")).set("text",Joomla.JText._("JNO"))]),new Element("br"),(new Element("div",g)).appendText(Joomla.JText._("COM_FABRIK_INCLUDE_DATA")),(new Element("label")).set("html",d),(new Element("label")).adopt([new Element("input",{type:"radio",name:"inctabledata",value:"0"}),(new Element("span")).set("text",Joomla.JText._("JNO"))]),new Element("br"),(new Element("div",g)).appendText(Joomla.JText._("COM_FABRIK_INCLUDE_RAW_DATA")),(new Element("label")).set("html",b),(new Element("label")).adopt([new Element("input",{type:"radio",name:"incraw",value:"0"}),(new Element("span")).set("text",Joomla.JText._("JNO"))]),new Element("br"),(new Element("div",g)).appendText(Joomla.JText._("COM_FABRIK_INLCUDE_CALCULATIONS")),(new Element("label")).set("html",c),(new Element("label")).adopt([new Element("input",{type:"radio",name:"inccalcs",value:"0"}),(new Element("span")).set("text",Joomla.JText._("JNO"))])]);(new Element("h4")).set("text",Joomla.JText._("COM_FABRIK_SELECT_COLUMNS_TO_EXPORT")).inject(h);var i="";var j=0;$H(this.options.labels).each(function(a,b){if(b.substr(0,7)!=="fabrik_"&&b!=="____form_heading"){var c=b.split("___")[0];if(c!==i){i=c;(new Element("h5")).set("text",i).inject(h)}var d="<input type='radio' value='1' name='fields["+b+"]' checked='checked' />"+Joomla.JText._("JYES");a=a.replace(/<\/?[^>]+(>|$)/g,"");var e=(new Element("div",g)).appendText(a);e.inject(h);(new Element("label")).set("html",d).inject(h);(new Element("label")).adopt([new Element("input",{type:"radio",name:"fields["+b+"]",value:"0"}),(new Element("span")).appendText(Joomla.JText._("JNO"))]).inject(h);(new Element("br")).inject(h)}j++}.bind(this));if(this.options.formels.length>0){(new Element("h5")).set("text",Joomla.JText._("COM_FABRIK_FORM_FIELDS")).inject(h);this.options.formels.each(function(a){var b="<input type='radio' value='1' name='fields["+a.name+"]' checked='checked' />"+Joomla.JText._("JYES");var c=(new Element("div",g)).appendText(a.label);c.inject(h);(new Element("label")).set("html",b).inject(h);(new Element("label")).adopt([new Element("input",{type:"radio",name:"fields["+a.name+"]",value:"0"}),(new Element("span")).set("text",Joomla.JText._("JNO"))]).inject(h);(new Element("br")).inject(h)}.bind(this))}(new Element("div",{styles:{"text-align":"right"}})).adopt(new Element("input",{type:"button",name:"submit",value:Joomla.JText._("COM_FABRIK_EXPORT"),"class":"button",events:{click:function(a){a.stop();a.target.disabled=true;(new Element("div",{id:"csvmsg"})).set("html",Joomla.JText._("COM_FABRIK_LOADING")+' <br /><span id="csvcount">0</span> / <span id="csvtotal"></span> '+Joomla.JText._("COM_FABRIK_RECORDS")+".<br/>"+Joomla.JText._("COM_FABRIK_SAVING_TO")+'<span id="csvfile"></span>').inject(a.target,"before");this.triggerCSVExport(0)}.bind(this)}})).inject(h);(new Element("input",{type:"hidden",name:"view",value:"table"})).inject(h);(new Element("input",{type:"hidden",name:"option",value:"com_fabrik"})).inject(h);(new Element("input",{type:"hidden",name:"listid",value:this.id})).inject(h);(new Element("input",{type:"hidden",name:"format",value:"csv"})).inject(h);(new Element("input",{type:"hidden",name:"c",value:"table"})).inject(h);return h},triggerCSVExport:function(a,b,c){if(a!==0){if(a===-1){a=0;b=this.csvopts;b.fields=this.csvfields}else{b=this.csvopts;c=this.csvfields}}else{if(!b){b={};if(typeOf(document.id("exportcsv"))!=="null"){$A(["incfilters","inctabledata","incraw","inccalcs","excel"]).each(function(a){var c=document.id("exportcsv").getElements("input[name="+a+"]");if(c.length>0){b[a]=c.filter(function(a){return a.checked})[0].value}})}}if(!c){c={};if(typeOf(document.id("exportcsv"))!=="null"){document.id("exportcsv").getElements("input[name^=field]").each(function(a){if(a.checked){var b=a.name.replace("fields[","").replace("]","");c[b]=a.get("value")}})}}b.fields=c;this.csvopts=b;this.csvfields=c}this.form.getElements(".fabrik_filter").each(function(a){b[a.name]=a.get("value")}.bind(this));b.start=a;b.option="com_fabrik";b.view="list";b.format="csv";b.Itemid=this.options.Itemid;b.listid=this.id;b.listref=this.id;var d=new Request.JSON({url:"",method:"post",data:b,onError:function(a,b){fconsole(a,b)},onSuccess:function(a){if(a.err){alert(a.err)}else{if(typeOf(document.id("csvcount"))!=="null"){document.id("csvcount").set("text",a.count)}if(typeOf(document.id("csvtotal"))!=="null"){document.id("csvtotal").set("text",a.total)}if(typeOf(document.id("csvfile"))!=="null"){document.id("csvfile").set("text",a.file)}if(a.count<a.total){this.triggerCSVExport(a.count)}else{var b=Fabrik.liveSite+"index.php?option=com_fabrik&view=list&format=csv&listid="+this.id+"&start="+a.count+"&Itemid="+this.options.Itemid;var c=Joomla.JText._("COM_FABRIK_CSV_COMPLETE");c+=' <a href="'+b+'">'+Joomla.JText._("COM_FABRIK_CSV_DOWNLOAD_HERE")+"</a>";if(typeOf(document.id("csvmsg"))!=="null"){document.id("csvmsg").set("html",c)}}}}.bind(this)});d.send()},addPlugins:function(a){a.each(function(a){a.list=this}.bind(this));this.plugins=a},watchEmpty:function(a){var b=document.id(this.options.form).getElement(".doempty",this.options.form);if(b){b.addEvent("click",function(a){a.stop();if(confirm(Joomla.JText._("COM_FABRIK_CONFIRM_DROP"))){this.submit("list.doempty")}}.bind(this))}},watchOrder:function(){var a=false;var b=document.id(this.options.form).getElements(".fabrikorder, .fabrikorder-asc, .fabrikorder-desc");b.removeEvents("click");b.each(function(b){b.addEvent("click",function(c){var d="";var e="";b=document.id(c.target);var f=b.getParent(".fabrik_ordercell");if(b.tagName!=="a"){b=f.getElement("a")}switch(b.className){case"fabrikorder-asc":e="fabrikorder-desc";d="desc";break;case"fabrikorder-desc":e="fabrikorder";d="-";break;case"fabrikorder":e="fabrikorder-asc";d="asc";break}f.className.split(" ").each(function(b){if(b.contains("_order")){a=b.replace("_order","").replace(/^\s+/g,"").replace(/\s+$/g,"")}});if(!a){fconsole("woops didnt find the element id, cant order");return}b.className=e;this.fabrikNavOrder(a,d);c.stop()}.bind(this))}.bind(this))},watchFilters:function(){var a="";var b=document.id(this.options.form).getElement(".fabrik_filter_submit");document.id(this.options.form).getElements(".fabrik_filter").each(function(c){a=c.get("tag")==="select"?"change":"blur";if(this.options.filterMethod!=="submitform"){c.removeEvent(a);c.store("initialvalue",c.get("value"));c.addEvent(a,function(a){a.stop();if(a.target.retrieve("initialvalue")!==a.target.get("value")){this.submit("list.filter")}}.bind(this))}else{c.addEvent(a,function(a){b.highlight("#ffaa00")}.bind(this))}}.bind(this));if(this.options.filterMethod==="submitform"){if(b){b.removeEvents();b.addEvent("click",function(a){this.submit("list.filter")}.bind(this))}}document.id(this.options.form).getElements(".fabrik_filter").addEvent("keydown",function(a){if(a.code===13){a.stop();this.submit("list.filter")}}.bind(this))},setActive:function(a){this.list.getElements(".fabrik_row").each(function(a){a.removeClass("activeRow")});a.addClass("activeRow")},getActiveRow:function(a){var b=a.target.getParent(".fabrik_row");if(!b){b=Fabrik.activeRow}return b},watchRows:function(){if(!this.list){return}if(this.options.ajax_links){this.getForm().removeEvents("click:relay(.fabrik_edit)");this.getForm().addEvent("click:relay(.fabrik_edit)",function(a){var b,c,d,e;a.stop();if(typeOf(a.target.getParent(".floating-tip-wrapper"))==="null"){e=a.target.getParent("form").getElement("input[name=listref]").get("value")}else{e=a.target.getParent(".floating-tip-wrapper").retrieve("listref")}var f=Fabrik.blocks["list_"+e];var g=f.getActiveRow(a);if(!g){return}f.setActive(g);var h=g.id.split("_").getLast();if(f.options.links.edit===""){b=Fabrik.liveSite+"index.php?option=com_fabrik&view=form&formid="+f.options.formid+"&rowid="+h+"&tmpl=component&ajax=1";c="xhr"}else{if(a.target.get("tag")==="a"){d=a.target}else{d=typeOf(a.target.getElement("a"))!=="null"?a.target.getElement("a"):a.target.getParent("a")}b=d.get("href");c="iframe"}var i={id:"add."+this.id,title:this.options.popup_edit_label,loadMethod:c,contentURL:b,width:this.options.popup_width,height:this.options.popup_height};if(typeOf(this.options.popup_offset_x)!=="null"){i.offset_x=this.options.popup_offset_x}if(typeOf(this.options.popup_offset_y)!=="null"){i.offset_y=this.options.popup_offset_y}Fabrik.getWindow(i)}.bind(this));this.getForm().removeEvents("click:relay(.fabrik_view)");this.getForm().addEvent("click:relay(.fabrik_view)",function(a){var b,c,d,e;a.stop();if(typeOf(a.target.getParent(".floating-tip-wrapper"))==="null"){e=a.target.getParent("form").getElement("input[name=listref]").get("value")}else{e=a.target.getParent(".floating-tip-wrapper").retrieve("listid")}var f=Fabrik.blocks["list_"+e];var g=f.getActiveRow(a);if(!g){return}f.setActive(g);var h=g.id.split("_").getLast();if(f.options.links.detail===""){b=Fabrik.liveSite+"index.php?option=com_fabrik&view=details&formid="+f.options.formid+"&rowid="+h+"&tmpl=component&ajax=1";c="xhr"}else{if(a.target.get("tag")==="a"){d=a.target}else{d=typeOf(a.target.getElement("a"))!=="null"?a.target.getElement("a"):a.target.getParent("a")}b=d.get("href");c="iframe"}var i={id:"view."+"."+f.options.formid+"."+h,title:this.options.popup_view_label,loadMethod:c,contentURL:b,width:this.options.popup_width,height:this.options.popup_height};if(typeOf(this.options.popup_offset_x)!=="null"){i.offset_x=this.options.popup_offset_x}if(typeOf(this.options.popup_offset_y)!=="null"){i.offset_y=this.options.popup_offset_y}Fabrik.getWindow(i)}.bind(this))}},getForm:function(){if(!this.form){this.form=document.id(this.options.form)}return this.form},submit:function(a){this.getForm();if(a==="list.delete"){var b=false;this.form.getElements("input[name^=ids]").each(function(a){if(a.checked){b=true}});if(!b){alert(Joomla.JText._("COM_FABRIK_SELECT_ROWS_FOR_DELETION"));Fabrik.loader.stop("listform_"+this.options.listRef);return false}if(!confirm(Joomla.JText._("COM_FABRIK_CONFIRM_DELETE"))){Fabrik.loader.stop("listform_"+this.options.listRef);return false}}Fabrik.loader.start("listform_"+this.options.listRef);if(a==="list.filter"){Fabrik["filter_listform_"+this.options.listRef].onSubmit();this.form.task.value=a;if(this.form["limitstart"+this.id]){this.form.getElement("#limitstart"+this.id).value=0}}else{if(a!==""){this.form.task.value=a}}if(this.options.ajax){this.form.getElement("input[name=option]").value="com_fabrik";this.form.getElement("input[name=view]").value="list";this.form.getElement("input[name=format]").value="raw";var c=this.form.toQueryString();if(a==="list.filter"&&this.advancedSearch!==false){var d=document.getElement("form.advancedSeach_"+this.options.listRef);if(typeOf(d)!=="null"){c+="&"+d.toQueryString();c+="&replacefilters=1"}}if(!this.request){this.request=new Request({url:this.form.get("action"),data:c,onComplete:function(a){a=JSON.decode(a);this._updateRows(a);Fabrik.loader.stop("listform_"+this.options.listRef);Fabrik["filter_listform_"+this.options.listRef].onUpdateData();Fabrik.fireEvent("fabrik.list.submit.ajax.complete",[this,a])}.bind(this)})}else{this.request.options.data=c}this.request.send();Fabrik.fireEvent("fabrik.list.submit",[a,this.form.toQueryString().toObject()])}else{this.form.submit();Fabrik.loader.stop("listform_"+this.options.listRef)}return false},fabrikNav:function(a){this.options.limitStart=a;this.form.getElement("#limitstart"+this.id).value=a;Fabrik.fireEvent("fabrik.list.navigate",[this,a]);if(!this.result){this.result=true;return false}this.submit("list.view");return false},fabrikNavOrder:function(a,b){this.form.orderby.value=a;this.form.orderdir.value=b;Fabrik.fireEvent("fabrik.list.order",[this,a,b]);if(!this.result){this.result=true;return false}this.submit("list.order")},removeRows:function(a){for(i=0;i<a.length;i++){var b=document.id("list_"+this.id+"_row_"+a[i]);var c=new Fx.Morph(b,{duration:1e3});c.start({backgroundColor:this.options.hightLight}).chain(function(){this.start({opacity:0})}).chain(function(){b.dispose();this.checkEmpty()}.bind(this))}},editRow:function(){},clearRows:function(){this.list.getElements(".fabrik_row").each(function(a){a.dispose()})},updateRows:function(){var a={option:"com_fabrik",view:"list",task:"list.view",format:"raw",listid:this.id};var b="";a["limit"+this.id]=this.options.limitLength;(new Request.JSON({url:b,data:a,onSuccess:function(a){this._updateRows(a)}.bind(this),onError:function(a,b){console.log(a,b)},onFailure:function(a){console.log(a)}})).send()},_updateRows:function(a){if(a.id===this.id&&a.model==="list"){var b=document.id(this.options.form).getElements(".fabrik___heading").getLast();var c=new Hash(a.headings);c.each(function(a,c){c="."+c;try{if(typeOf(b.getElement(c))!=="null"){b.getElement(c).getElement("span").set("html",a)}}catch(d){fconsole(d)}});this.setRowTemplate();this.clearRows();var d=0;var e=0;trs=[];this.options.data=a.data;if(a.calculations){this.updateCals(a.calculations)}if(typeOf(this.form.getElement(".fabrikNav"))!=="null"){this.form.getElement(".fabrikNav").set("html",a.htmlnav)}var f=this.options.isGrouped?$H(a.data):a.data;var g=0;f.each(function(a,b){var c,f;var h=this.options.isGrouped?this.list.getElements(".fabrik_groupdata")[g]:this.tbody;g++;for(i=0;i<a.length;i++){if(typeOf(this.options.rowtemplate)==="string"){c=!this.options.rowtemplate.match(/<tr/)?"div":"table";f=new Element(c);f.set("html",this.options.rowtemplate)}else{c=this.options.rowtemplate.get("tag")==="tr"?"table":"div";f=new Element(c);f.adopt(this.options.rowtemplate.clone())}var k=$H(a[i]);$H(k.data).each(function(a,b){var c="."+b;var d=f.getElement(c);if(typeOf(d)!=="null"&&d.get("tag")!=="a"){d.set("html",a)}e++}.bind(this));f.getElement(".fabrik_row").id=k.id;if(typeOf(this.options.rowtemplate)==="string"){var l=f.getElement(".fabrik_row").clone();l.id=k.id;var m=k["class"].split(" ");for(j=0;j<m.length;j++){l.addClass(m[j])}l.inject(h)}else{var n=f.getElement(".fabrik_row");n.inject(h);f.empty()}d++}}.bind(this));var h=this.list.getParent(".fabrikDataContainer");var k=this.list.getParent(".fabrikForm").getElement(".emptyDataMessage");if(e===0){if(typeOf(k)!=="null"){k.setStyle("display","")}}else{if(typeOf(h)!=="null"){h.setStyle("display","")}if(typeOf(k)!=="null"){k.setStyle("display","none")}}if(typeOf(this.form.getElement(".fabrikNav"))!=="null"){this.form.getElement(".fabrikNav").set("html",a.htmlnav)}this.watchAll(true);Fabrik.fireEvent("fabrik.list.updaterows");Fabrik.fireEvent("fabrik.list.update",[this,a])}this.stripe();Fabrik.loader.stop("listform_"+this.options.listRef)},addRow:function(a){var b=new Element("tr",{"class":"oddRow1"});var c={test:"hi"};for(var d in a){if(this.options.headings.indexOf(d)!==-1){var e=(new Element("td",{})).appendText(a[d]);b.appendChild(e)}}b.inject(this.tbody)},addRows:function(a){for(i=0;i<a.length;i++){for(j=0;j<a[i].length;j++){this.addRow(a[i][j])}}this.stripe()},stripe:function(){var a=this.list.getElements(".fabrik_row");for(i=0;i<a.length;i++){if(!a[i].hasClass("fabrik___header")){var b="oddRow"+i%2;a[i].addClass(b)}}},checkEmpty:function(){var a=this.list.getElements("tr");if(a.length===2){this.addRow({label:Joomla.JText._("COM_FABRIK_NO_RECORDS")})}},watchCheckAll:function(a){var b=this.form.getElement("input[name=checkAll]");if(typeOf(b)!=="null"){b.addEvent("click",function(a){var b=this.list.getParent(".fabrikList")?this.list.getParent(".fabrikList"):this.list;var d=b.getElements("input[name^=ids]");c=!a.target.checked?"":"checked";for(var e=0;e<d.length;e++){d[e].checked=c;this.toggleJoinKeysChx(d[e])}}.bind(this))}this.form.getElements("input[name^=ids]").each(function(a){a.addEvent("change",function(b){this.toggleJoinKeysChx(a)}.bind(this))}.bind(this))},toggleJoinKeysChx:function(a){a.getParent().getElements("input[class=fabrik_joinedkey]").each(function(b){b.checked=a.checked})},watchNav:function(a){var b=this.form.getElement("select[name*=limit]");if(b){b.addEvent("change",function(a){var b=Fabrik.fireEvent("fabrik.list.limit",[this]);if(this.result===false){this.result=true;return false}this.submit("list.filter")}.bind(this))}var c=this.form.getElement(".addRecord");if(typeOf(c)!=="null"&&this.options.ajax_links){c.removeEvents();var d=this.options.links.add===""||c.href.contains(Fabrik.liveSite)?"xhr":"iframe";c.addEvent("click",function(a){a.stop();var b={id:"add."+this.id,title:this.options.popup_add_label,loadMethod:d,contentURL:c.href,width:this.options.popup_width,height:this.options.popup_height};if(typeOf(this.options.popup_offset_x)!=="null"){b.offset_x=this.options.popup_offset_x}if(typeOf(this.options.popup_offset_y)!=="null"){b.offset_y=this.options.popup_offset_y}Fabrik.getWindow(b)}.bind(this))}if(document.id("fabrik__swaptable")){document.id("fabrik__swaptable").addEvent("change",function(a){window.location="index.php?option=com_fabrik&task=list.view&cid="+a.target.get("value")}.bind(this))}if(this.options.ajax){if(typeOf(this.form.getElement(".pagination"))!=="null"){this.form.getElement(".pagination").getElements(".pagenav").each(function(a){a.addEvent("click",function(b){b.stop();if(a.get("tag")==="a"){var c=a.href.toObject();this.fabrikNav(c["limitstart"+this.id])}}.bind(this))}.bind(this))}}if(this.options.admin){Fabrik.addEvent("fabrik.block.added",function(a){if(a.options.listRef===this.options.listRef){var b=a.form.getElement(".fabrikNav");if(typeOf(b)!=="null"){b.getElements("a").addEvent("click",function(b){b.stop();a.fabrikNav(b.target.get("href"))})}}}.bind(this))}this.watchCheckAll()},updateCals:function(a){var b=["sums","avgs","count","medians"];this.form.getElements(".fabrik_calculations").each(function(c){b.each(function(b){$H(a[b]).each(function(a,b){var d=c.getElement(".fabrik_row___"+b);if(typeOf(d)!=="null"){d.set("html",a)}})})})}});var FbListKeys=new Class({initialize:function(a){window.addEvent("keyup",function(b){if(b.alt){switch(b.key){case Joomla.JText._("COM_FABRIK_LIST_SHORTCUTS_ADD"):var c=a.form.getElement(".addRecord");if(a.options.ajax){c.fireEvent("click")}if(c.getElement("a")){a.options.ajax?c.getElement("a").fireEvent("click"):document.location=c.getElement("a").get("href")}else{if(!a.options.ajax){document.location=c.get("href")}}break;case Joomla.JText._("COM_FABRIK_LIST_SHORTCUTS_EDIT"):fconsole("edit");break;case Joomla.JText._("COM_FABRIK_LIST_SHORTCUTS_DELETE"):fconsole("delete");break;case Joomla.JText._("COM_FABRIK_LIST_SHORTCUTS_FILTER"):fconsole("filter");break}}}.bind(this))}});var FbGroupedToggler=new Class({initialize:function(a){a.addEvent("click:relay(.fabrik_groupheading a.toggle)",function(a){a.stop();a.preventDefault();var b=a.target.getParent(".fabrik_groupheading");var c=b.getElement("img");var d=c.retrieve("showgroup",true);var e=b.getParent().getNext();d?e.hide():e.show();if(d){c.src=c.src.replace("orderasc","orderneutral")}else{c.src=c.src.replace("orderneutral","orderasc")}d=d?false:true;c.store("showgroup",d);return false})}});var FbListActions=new Class({Implements:[Options],options:{method:"",floatPos:"bottom"},initialize:function(a,b){this.setOptions(b);this.list=a;this.actions=[];this.setUpSubMenus();Fabrik.addEvent("fabrik.list.update",function(a,b){this.observe()}.bind(this));this.observe()},observe:function(){if(this.options.method==="floating"){this.setUpFloating()}else{this.setUpDefault()}},setUpSubMenus:function(){if(!this.list.form){return}this.actions=this.list.form.getElements("ul.fabrik_action");this.actions.each(function(a){if(a.getElement("ul")){var b=a.getElement("ul");var c=(new Element("div")).adopt(b.clone());var d=b.getPrevious();if(d.getElement(".fabrikTip")){d=d.getElement(".fabrikTip")}var e=Object.merge(Object.clone(Fabrik.tips.options),{showOn:"click",hideOn:"click",position:"bottom",content:c});var f=new FloatingTips(d,e);b.dispose()}})},setUpDefault:function(){this.actions=this.list.form.getElements("ul.fabrik_action");this.actions.each(function(a){if(a.getParent().hasClass("fabrik_buttons")){return}a.fade(.6);var b=a.getParent(".fabrik_row")?a.getParent(".fabrik_row"):a.getParent(".fabrik___heading");if(b){b.addEvents({mouseenter:function(b){a.fade(.99)},mouseleave:function(b){a.fade(.6)}})}})},setUpFloating:function(){this.list.form.getElements("ul.fabrik_action").each(function(a){if(a.getParent(".fabrik_row")){if(i=a.getParent(".fabrik_row").getElement("input[type=checkbox]")){var b=function(a,b,c){if(!a.target.checked){this.hide(a,b)}if(c==="tip"){}};var c=function(b,c){var d=a.getParent();d.store("activeRow",a.getParent(".fabrik_row"));return d}.bind(this.list);var d={position:this.options.floatPos,showOn:"click",hideOn:"click",content:c,hideFn:function(a){return!a.target.checked},showFn:function(b,c){Fabrik.activeRow=a.getParent().retrieve("activeRow");c.store("list",this.list);return b.target.checked}.bind(this.list)};var e=Object.merge(Object.clone(Fabrik.tips.options),d);var f=new FloatingTips(i,e)}}}.bind(this));var a=this.list.form.getElement("input[name=checkAll]");var b=function(a){return a.getParent(".fabrik___heading").getElement("ul.fabrik_action")};var c=Object.merge(Object.clone(Fabrik.tips.options),{position:this.options.floatPos,html:true,showOn:"click",hideOn:"click",content:b,hideFn:function(a){return!a.target.checked},showFn:function(a,b){b.retrieve("tip").click.store("list",this.list);return a.target.checked}.bind(this.list)});var d=new FloatingTips(a,c);if(this.list.form.getElements(".fabrik_actions")){this.list.form.getElements(".fabrik_actions").hide()}if(this.list.form.getElements(".fabrik_calculation")){var e=this.list.form.getElements(".fabrik_calculation").getLast();if(typeOf(e)!=="null"){e.hide()}}}})