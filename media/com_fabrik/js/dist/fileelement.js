/*! Fabrik */
define(["jquery"],function(){return window.FbFileElement=new Class({Extends:FbElement,ajaxFolder:function(){if(this.folderlist=[],"null"!==typeOf(this.element)){var a=this.element.getParent(".fabrikElement");this.breadcrumbs=a.getElement(".breadcrumbs"),this.folderdiv=a.getElement(".folderselect"),this.slider=new Fx.Slide(this.folderdiv,{duration:500}),this.slider.hide(),this.hiddenField=a.getElement(".folderpath"),a.getElement(".toggle").addEvent("click",function(a){a.stop(),this.slider.toggle()}.bind(this)),this.watchAjaxFolderLinks()}},watchAjaxFolderLinks:function(){this.folderdiv.getElements("a").addEvent("click",function(a){this.browseFolders(a)}.bind(this)),this.breadcrumbs.getElements("a").addEvent("click",function(a){this.useBreadcrumbs(a)}.bind(this))},browseFolders:function(a){a.stop(),this.folderlist.push(a.target.get("text"));var b=this.options.dir+this.folderlist.join(this.options.ds);this.addCrumb(a.target.get("text")),this.doAjaxBrowse(b)},useBreadcrumbs:function(a){a.stop();var b=a.target.className;this.folderlist=[];var c=(this.breadcrumbs.getElements("a").every(function(c){return c.className===b?!1:(this.folderlist.push(a.target.innerHTML),!0)},this),[this.breadcrumbs.getElements("a").shift().clone(),this.breadcrumbs.getElements("span").shift().clone()]);this.breadcrumbs.empty(),this.breadcrumbs.adopt(c),this.folderlist.each(function(a){this.addCrumb(a)},this);var d=this.options.dir+this.folderlist.join(this.options.ds);this.doAjaxBrowse(d)},doAjaxBrowse:function(a){var b={dir:a,option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",plugin:"fileupload",method:"ajax_getFolders",element_id:this.options.id};new Request({url:"",data:b,onComplete:function(a){a=JSON.decode(a),this.folderdiv.empty(),a.each(function(a){new Element("li",{"class":"fileupload_folder"}).adopt(new Element("a",{href:"#"}).set("text",a)).inject(this.folderdiv)}.bind(this)),0===a.length?this.slider.hide():this.slider.slideIn(),this.watchAjaxFolderLinks(),this.hiddenField.value="/"+this.folderlist.join("/")+"/",this.fireEvent("onBrowse")}.bind(this)}).send()},addCrumb:function(a){this.breadcrumbs.adopt(new Element("a",{href:"#","class":"crumb"+this.folderlist.length}).set("text",a),new Element("span").set("text"," / "))}}),window.FbFileElement});