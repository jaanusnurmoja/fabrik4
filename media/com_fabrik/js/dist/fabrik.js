/*! Fabrik */
define(["jquery","fab/loader","fab/requestqueue"],function(a,b,c){document.addEvent("click:relay(.popover button.close)",function(b,c){var d="#"+c.get("data-popover"),e=document.getElement(d);a(d).popover("hide"),"null"!==typeOf(e)&&"input"===e.get("tag")&&(e.checked=!1)});var d={};return d.events={},d.bootstrapVersion=function(b){b=b||"modal";var c=a.fn[b];if(c){if(c.VERSION)return c.VERSION;if("modal"===b)return-1===c.toString().indexOf("bs.modal")?"2.x":"3.x"}},d.Windows={},d.loader=new b,d.blocks={},d.periodicals={},d.addBlock=function(a,b){d.blocks[a]=b,d.fireEvent("fabrik.block.added",[b,a])},d.getBlock=function(a,b,c){return c=c?c:!1,c&&(d.periodicals[a]=d._getBlock.periodical(500,this,[a,b,c])),d._getBlock(a,b,c)},d._getBlock=function(a,b,c){var e;if(b=b?b:!1,void 0!==d.blocks[a])e=a;else{if(b)return!1;var f=Object.keys(d.blocks),g=f.searchFor(a);if(-1===g)return!1;e=f[g]}return c&&(clearInterval(d.periodicals[a]),c(d.blocks[e])),d.blocks[e]},document.addEvent("click:relay(.fabrik_delete a, .fabrik_action a.delete, .btn.delete)",function(a,b){a.rightClick||d.watchDelete(a,b)}),document.addEvent("click:relay(.fabrik_edit a, a.fabrik_edit)",function(a,b){a.rightClick||d.watchEdit(a,b)}),document.addEvent("click:relay(.fabrik_view a, a.fabrik_view)",function(a,b){a.rightClick||d.watchView(a,b)}),document.addEvent("click:relay(*[data-fabrik-view])",function(a){if(!a.rightClick){var b,c,e;a.preventDefault(),c="a"===a.target.get("tag")?a.target:"null"!==typeOf(a.target.getElement("a"))?a.target.getElement("a"):a.target.getParent("a"),b=c.get("href"),b+=b.contains("?")?"&tmpl=component&ajax=1":"?tmpl=component&ajax=1",$H(d.Windows).each(function(a){a.close()}),e=c.get("title"),e||(e=Joomla.JText._("COM_FABRIK_VIEW"));var f={id:"view."+b,title:e,loadMethod:"xhr",contentURL:b};d.getWindow(f)}}),d.removeEvent=function(a,b){if(d.events[a]){var c=d.events[a].indexOf(b);-1!==c&&delete d.events[a][c]}},d.addEvent=d.on=function(a,b){d.events[a]||(d.events[a]=[]),d.events[a].contains(b)||d.events[a].push(b)},d.addEvents=function(a){var b;for(b in a)a.hasOwnProperty(b)&&d.addEvent(b,a[b]);return this},d.fireEvent=d.trigger=function(a,b,c){var e=d.events;return this.eventResults=[],e&&e[a]?(b=Array.from(b),e[a].each(function(a){this.eventResults.push(c?a.delay(c,this,b):a.apply(this,b))},this),this):this},d.requestQueue=new c,d.cbQueue={google:[]},d.loadGoogleMap=function(a,b){var c="https:"===document.location.protocol?"https:":"http:",e=c+"//maps.googleapis.com/maps/api/js?&sensor="+a+"&libraries=places&callback=Fabrik.mapCb",f=Array.from(document.scripts).filter(function(a){return a.src===e});if(0===f.length){var g=document.createElement("script");g.type="text/javascript",g.src=e,document.body.appendChild(g),d.cbQueue.google.push(b)}else d.googleMap?window[b]():d.cbQueue.google.push(b)},d.mapCb=function(){d.googleMap=!0;var a,b;for(b=0;b<d.cbQueue.google.length;b++)a=d.cbQueue.google[b],"function"===typeOf(a)?a():window[a]();d.cbQueue.google=[]},d.watchDelete=function(a,b){var c,e,f;if(f=a.target.getParent(".fabrik_row"),f||(f=d.activeRow),f){var g=f.getElement("input[type=checkbox][name*=id]");"null"!==typeOf(g)&&(g.checked=!0),e=f.id.split("_"),e=e.splice(0,e.length-2).join("_"),c=d.blocks[e]}else if(e=a.target.getParent(".fabrikList"),"null"!==typeOf(e))e=e.id,c=d.blocks[e];else{var h=b.getParent(".floating-tip-wrapper");if(h){var i=h.retrieve("list");e=i.id}else e=b.get("data-listRef");c=d.blocks[e],void 0===c||"floating"!==c.options.actionMethod||this.bootstrapped||c.form.getElements("input[type=checkbox][name*=id], input[type=checkbox][name=checkAll]").each(function(a){a.checked=!0})}c.submit("list.delete")||a.stop()},d.watchEdit=function(a,b){d.openSingleView("form",a,b)},d.watchView=function(a,b){d.openSingleView("details",a,b)},d.openSingleView=function(b,c,e){var f,g,h,i,j,k,l,m=a(e).data("list"),n=d.blocks[m];n.options.ajax_links&&(c.preventDefault(),k=n.getActiveRow(c),k&&0!==k.length&&(n.setActive(k),j=k.prop("id").split("_").pop(),h="A"===a(c.target).prop("tagName")?a(c.target):a(c.target).find("a").length>0?a(c.target).find("a"):a(c.target).closest("a"),f=h.prop("href"),f+=f.contains("?")?"&tmpl=component&ajax=1":"?tmpl=component&ajax=1",i=h.prop("title"),g=h.data("loadmethod"),void 0===g&&(g="xhr"),a(d.Windows,function(a,b){b.close()}),l={modalId:"ajax_links",id:m+"."+j,title:i,loadMethod:g,contentURL:f,onClose:function(){var a=b+"_"+n.options.formid+"_"+j;try{d.blocks[a].destroyElements(),d.blocks[a].formElements=null,d.blocks[a]=null,delete d.blocks[a];var c="details"===b?"fabrik.list.row.view.close":"fabrik.list.row.edit.close";d.fireEvent(c,[m,j,a])}catch(e){console.log(e)}}},""!==n.options.popup_width&&(l.width=n.options.popup_width),""!==n.options.popup_height&&(l.width=n.options.popup_height),l.id="details"===b?"view."+l.id:"add."+l.id,null!==n.options.popup_offset_x&&(l.offset_x=n.options.popup_offset_x),null!==n.options.popup_offset_y&&(l.offset_y=n.options.popup_offset_y),d.getWindow(l)))},d.Array={chunk:function(a,b){var c,d,e=[];for(c=0,d=a.length;d>c;c+=b)e.push(a.slice(c,c+b));return e}},window.fireEvent("fabrik.loaded"),window.Fabrik=d,d});