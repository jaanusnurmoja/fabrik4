/*! Fabrik */
define(["jquery"],function(a){document.addEvent("click:relay(.popover button.close)",function(b,c){var d="#"+c.get("data-popover"),e=document.getElement(d);a(d).popover("hide"),"null"!==typeOf(e)&&"input"===e.get("tag")&&(e.checked=!1)});var b={};return b.events={},b.bootstrapVersion=function(b){b=b||"modal";var c=a.fn[b];if(c){if(c.VERSION)return c.VERSION;if("modal"===b)return-1===c.toString().indexOf("bs.modal")?"2.x":"3.x"}},b.Windows={},b.loader=new Loader,b.blocks={},b.periodicals={},b.addBlock=function(a,c){b.blocks[a]=c,b.fireEvent("fabrik.block.added",[c,a])},b.getBlock=function(a,c,d){return d=d?d:!1,d&&(b.periodicals[a]=b._getBlock.periodical(500,this,[a,c,d])),b._getBlock(a,c,d)},b._getBlock=function(a,c,d){var e;if(c=c?c:!1,void 0!==b.blocks[a])e=a;else{if(c)return!1;var f=Object.keys(b.blocks),g=f.searchFor(a);if(-1===g)return!1;e=f[g]}return d&&(clearInterval(b.periodicals[a]),d(b.blocks[e])),b.blocks[e]},document.addEvent("click:relay(.fabrik_delete a, .fabrik_action a.delete, .btn.delete)",function(a,c){a.rightClick||b.watchDelete(a,c)}),document.addEvent("click:relay(.fabrik_edit a, a.fabrik_edit)",function(a,c){a.rightClick||b.watchEdit(a,c)}),document.addEvent("click:relay(.fabrik_view a, a.fabrik_view)",function(a,c){a.rightClick||b.watchView(a,c)}),document.addEvent("click:relay(*[data-fabrik-view])",function(a){if(!a.rightClick){var c,d,e;a.preventDefault(),d="a"===a.target.get("tag")?a.target:"null"!==typeOf(a.target.getElement("a"))?a.target.getElement("a"):a.target.getParent("a"),c=d.get("href"),c+=c.contains("?")?"&tmpl=component&ajax=1":"?tmpl=component&ajax=1",$H(b.Windows).each(function(a){a.close()}),e=d.get("title"),e||(e=Joomla.JText._("COM_FABRIK_VIEW"));var f={id:"view."+c,title:e,loadMethod:"xhr",contentURL:c};b.getWindow(f)}}),b.removeEvent=function(a,c){if(b.events[a]){var d=b.events[a].indexOf(c);-1!==d&&delete b.events[a][d]}},b.addEvent=b.on=function(a,c){b.events[a]||(b.events[a]=[]),b.events[a].contains(c)||b.events[a].push(c)},b.addEvents=function(a){var c;for(c in a)a.hasOwnProperty(c)&&b.addEvent(c,a[c]);return this},b.fireEvent=b.trigger=function(a,c,d){var e=b.events;return this.eventResults=[],e&&e[a]?(c=Array.from(c),e[a].each(function(a){this.eventResults.push(d?a.delay(d,this,c):a.apply(this,c))},this),this):this},b.requestQueue=new RequestQueue,b.cbQueue={google:[]},b.loadGoogleMap=function(a,c){var d="https:"===document.location.protocol?"https:":"http:",e=d+"//maps.googleapis.com/maps/api/js?&sensor="+a+"&libraries=places&callback=Fabrik.mapCb",f=Array.from(document.scripts).filter(function(a){return a.src===e});if(0===f.length){var g=document.createElement("script");g.type="text/javascript",g.src=e,document.body.appendChild(g),b.cbQueue.google.push(c)}else b.googleMap?window[c]():b.cbQueue.google.push(c)},b.mapCb=function(){b.googleMap=!0;var a,c;for(c=0;c<b.cbQueue.google.length;c++)a=b.cbQueue.google[c],"function"===typeOf(a)?a():window[a]();b.cbQueue.google=[]},b.watchDelete=function(a,c){var d,e,f;if(f=a.target.getParent(".fabrik_row"),f||(f=b.activeRow),f){var g=f.getElement("input[type=checkbox][name*=id]");"null"!==typeOf(g)&&(g.checked=!0),e=f.id.split("_"),e=e.splice(0,e.length-2).join("_"),d=b.blocks[e]}else if(e=a.target.getParent(".fabrikList"),"null"!==typeOf(e))e=e.id,d=b.blocks[e];else{var h=c.getParent(".floating-tip-wrapper");if(h){var i=h.retrieve("list");e=i.id}else e=c.get("data-listRef");d=b.blocks[e],"floating"!==d.options.actionMethod||this.bootstrapped||d.form.getElements("input[type=checkbox][name*=id], input[type=checkbox][name=checkAll]").each(function(a){a.checked=!0})}d.submit("list.delete")||a.stop()},b.watchEdit=function(a,c){b.openSingleView("form",a,c)},b.watchView=function(a,c){b.openSingleView("details",a,c)},b.openSingleView=function(c,d,e){var f,g,h,i,j=a(e).data("list"),k=b.blocks[j];if(k.options.ajax_links){d.preventDefault();var l=k.getActiveRow(d);if(l){k.setActive(l);var m=l.id.split("_").pop();h="A"===a(d.target).prop("tagName")?a(d.target):a(d.target).find("a").length>0?a(d.target).find("a"):a(d.target).closest("a"),f=h.prop("href"),f+=f.contains("?")?"&tmpl=component&ajax=1":"?tmpl=component&ajax=1",i=h.prop("title"),g=h.data("loadmethod"),void 0===g&&(g="xhr"),a(b.Windows,function(a,b){b.close()});var n={modalId:"ajax_links",id:j+"."+m,title:i,loadMethod:g,contentURL:f,onClose:function(){var a=c+"_"+k.options.formid+"_"+m;try{b.blocks[a].destroyElements(),b.blocks[a].formElements=null,b.blocks[a]=null,delete b.blocks[a];var d="details"===c?"fabrik.list.row.view.close":"fabrik.list.row.edit.close";b.fireEvent(d,[j,m,a])}catch(e){console.log(e)}}};""!==k.options.popup_width&&(n.width=k.options.popup_width),""!==k.options.popup_height&&(n.width=k.options.popup_height),n.id="details"===c?"view."+n.id:"add."+n.id,null!==k.options.popup_offset_x&&(n.offset_x=k.options.popup_offset_x),null!==k.options.popup_offset_y&&(n.offset_y=k.options.popup_offset_y),b.getWindow(n)}}},b.Array={chunk:function(a,b){var c,d,e=[];for(c=0,d=a.length;d>c;c+=b)e.push(a.slice(c,c+b));return e}},window.fireEvent("fabrik.loaded"),window.Fabrik=b,b});