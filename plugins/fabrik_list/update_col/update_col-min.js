/*! Fabrik */
UpdateColSelect=new Class({initialize:function(){this.updates={}},addFilter:function(a,b){this.updates[a]||(this.updates[a]=[]),this.updates[a].push(b)},onSumbit:function(){this.updates.date&&this.updates.date.each(function(a){a.onSubmit()})}});var FbListUpdateCol=new Class({Extends:FbListPlugin,initialize:function(a){this.parent(a),this.options.userSelect&&(Fabrik["filter_update_col"+this.options.ref+"_"+this.options.renderOrder]=new UpdateColSelect,this.makeUpdateColWindow())},buttonAction:function(){this.options.userSelect?this.win.open():this.list.submit("list.doPlugin")},makeUpdateColWindow:function(){this.windowopts={id:"update_col_win_"+this.options.ref+"_"+this.options.renderOrder,title:Joomla.JText._("PLG_LIST_UPDATE_COL_UPDATE"),loadMethod:"html",content:this.options.form,width:400,destroy:!1,height:300,onOpen:function(){this.fitToContent(!1)},onContentLoaded:function(a){var b=document.id("update_col"+this.options.ref+"_"+this.options.renderOrder);b.addEvent("click:relay(a.add)",function(a,c){a.preventDefault();var d,e=c.getParent("thead");d=e?b.getElements("tbody tr").getLast():c.getParent("tr"),"none"===d.getStyle("display")?(tds=d.getElements("td"),tds[0].getElement("select").selectedIndex=0,tds[1].empty(),d.show()):(tr_clone=d.clone(),tds=tr_clone.getElements("td"),tds[0].getElement("select").selectedIndex=0,tds[1].empty(),tr_clone.inject(d,"after"))}),b.addEvent("click:relay(a.delete)",function(a,c){a.preventDefault();var d=b.getElements("tbody tr");1===d.length?d.getLast().hide():c.getParent("tr").destroy()}),b.addEvent("change:relay(select.key)",function(b,c){var d=c.getParent("tbody").getElements(".update_col_elements");for(i=0;i<d.length;i++)if(d[i]!==c&&d[i].selectedIndex===c.selectedIndex)return void alert("This element has already been selected!");var e=c.options[c.selectedIndex],f=c.getParent("tr");Fabrik.loader.start(f);var g=f.getElement("td.update_col_value"),h=c.get("value"),j=e.get("data-plugin"),k=e.get("data-id"),l=0,m="index.php?option=com_fabrik&task=list.elementFilter&format=raw";new Request.HTML({url:m,update:g,data:{element:h,id:this.options.listid,elid:k,plugin:j,counter:l,listref:this.options.ref,context:"visualization",parentView:"update_col"+this.options.ref+"_"+this.options.renderOrder,fabrikIngoreDefaultFilterVal:1},onComplete:function(){Fabrik.loader.stop(f),a.fitToContent(!1)}}).send()}.bind(this)),b.getElement("input[type=button]").addEvent("click",function(a){a.stop();var c;Fabrik["filter_update_col"+this.options.ref+"_"+this.options.renderOrder].onSumbit();var d=document.id("listform_"+this.options.ref);c=new Element("input",{type:"hidden",value:b.toQueryString(),name:"fabrik_update_col"}),c.inject(d,"bottom"),this.list.submit("list.doPlugin")}.bind(this))}.bind(this)},this.win=Fabrik.getWindow(this.windowopts),this.win.close()}});