UpdateColSelect=new Class({initialize:function(){this.updates={}},addFilter:function(b,a){if(!this.updates[b]){this.updates[b]=[]}this.updates[b].push(a)},onSumbit:function(){if(this.updates.date){this.updates.date.each(function(a){a.onSubmit()})}}});var FbListUpdateCol=new Class({Extends:FbListPlugin,initialize:function(a){this.parent(a);if(this.options.userSelect){Fabrik["filter_update_col"+this.options.ref+"_"+this.options.renderOrder]=new UpdateColSelect();this.makeUpdateColWindow()}},buttonAction:function(){if(this.options.userSelect){this.win.open()}else{this.list.submit("list.doPlugin")}},makeUpdateColWindow:function(){this.windowopts={id:"update_col_win_"+this.options.ref+"_"+this.options.renderOrder,title:Joomla.JText._("PLG_LIST_UPDATE_COL_UPDATE"),loadMethod:"html",content:this.options.form,width:400,destroy:false,height:300,onOpen:function(){this.fitToContent(false)},onContentLoaded:function(b){var a=document.id("update_col"+this.options.ref+"_"+this.options.renderOrder);a.addEvent("click:relay(a.add)",function(g,f){g.preventDefault();var d;var c=f.getParent("thead");if(c){d=a.getElements("tbody tr").getLast()}else{d=f.getParent("tr")}if(d.getStyle("display")==="none"){tds=d.getElements("td");tds[0].getElement("select").selectedIndex=0;tds[1].empty();d.show()}else{tr_clone=d.clone();tds=tr_clone.getElements("td");tds[0].getElement("select").selectedIndex=0;tds[1].empty();tr_clone.inject(d,"after")}});a.addEvent("click:relay(a.delete)",function(f,d){f.preventDefault();var c=a.getElements("tbody tr");if(c.length===1){c.getLast().hide()}else{d.getParent("tr").destroy()}});a.addEvent("change:relay(select.key)",function(l,m){var j=m.getParent("tbody").getElements(".update_col_elements");for(i=0;i<j.length;i++){if(j[i]===m){continue}if(j[i].selectedIndex===m.selectedIndex){alert("This element has already been selected!");return}}var g=m.options[m.selectedIndex];var o=m.getParent("tr");Fabrik.loader.start(o);var h=o.getElement("td.update_col_value");var n=m.get("value");var k=g.get("data-plugin");var f=g.get("data-id");var c=0;var d="index.php?option=com_fabrik&task=list.elementFilter&format=raw";new Request.HTML({url:d,update:h,data:{element:n,id:this.options.listid,elid:f,plugin:k,counter:c,listref:this.options.ref,context:"visualization",parentView:"update_col"+this.options.ref+"_"+this.options.renderOrder,fabrikIngoreDefaultFilterVal:1},onComplete:function(){Fabrik.loader.stop(o);b.fitToContent(false)}}).send()}.bind(this));a.getElement("input[type=button]").addEvent("click",function(f){f.stop();var c;Fabrik["filter_update_col"+this.options.ref+"_"+this.options.renderOrder].onSumbit();var d=document.id("listform_"+this.options.ref);c=new Element("input",{type:"hidden",value:a.toQueryString(),name:"fabrik_update_col"});c.inject(d,"bottom");this.list.submit("list.doPlugin")}.bind(this))}.bind(this)};this.win=Fabrik.getWindow(this.windowopts);this.win.close()}});