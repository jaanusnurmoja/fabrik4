var FbRatingList=new Class({options:{userid:0,mode:"",formid:0},Implements:[Events,Options],initialize:function(b,a){a.element=b;this.setOptions(a);if(this.options.canRate===false){return}if(this.options.mode==="creator-rating"){return}this.col=$$("."+b);this.origRating={};this.col.each(function(d){var c=d.getElements(".starRating");c.each(function(e){e.addEvent("mouseover",function(f){this.origRating[d.id]=e.getParent(".fabrik_element").getElement(".ratingMessage").innerHTML.toInt();c.each(function(g){if(this._getRating(e)>=this._getRating(g)){if(Fabrik.bootstrapped){g.removeClass("icon-star-empty").addClass("icon-star")}else{g.src=this.options.insrc}}else{if(Fabrik.bootstrapped){g.addClass("icon-star-empty").removeClass("icon-star")}else{g.src=this.options.insrc}}}.bind(this));e.getParent(".fabrik_element").getElement(".ratingMessage").innerHTML=e.get("data-fabrik-rating")}.bind(this));e.addEvent("mouseout",function(f){c.each(function(g){if(this.origRating[d.id]>=this._getRating(g)){if(Fabrik.bootstrapped){g.removeClass("icon-star-empty").addClass("icon-star")}else{g.src=this.options.insrc}}else{if(Fabrik.bootstrapped){g.addClass("icon-star-empty").removeClass("icon-star")}else{g.src=this.options.insrc}}}.bind(this));e.getParent(".fabrik_element").getElement(".ratingMessage").innerHTML=this.origRating[d.id]}.bind(this))}.bind(this));c.each(function(e){e.addEvent("click",function(f){this.doAjax(f,e)}.bind(this))}.bind(this))}.bind(this))},_getRating:function(a){var b=a.get("data-fabrik-rating");return b.toInt()},doAjax:function(f,d){f.stop();this.rating=this._getRating(d);var h=d.getParent(".fabrik_element").getElement(".ratingMessage");Fabrik.loader.start(h);var i=new Element("div",{id:"starRatingCover",styles:{bottom:0,top:0,right:0,left:0,position:"absolute",cursor:"progress"}});var a=d.getParent(".fabrik_element").getElement("div");a.grab(i,"top");var g=document.id(d).getParent(".fabrik_row");var b=g.id.replace("list_"+this.options.listRef+"_row_","");var c={option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",plugin:"rating",g:"element",method:"ajax_rate",formid:this.options.formid,element_id:this.options.elid,row_id:b,elementname:this.options.elid,userid:this.options.userid,rating:this.rating,mode:this.options.mode};new Request({url:"",data:c,onComplete:function(j){j=j.toInt();this.rating=j;h.set("html",this.rating);Fabrik.loader.stop(h);var e=Fabrik.bootstrapped?"i":"img";d.getParent(".fabrik_element").getElements(e).each(function(l,k){if(k<j){if(Fabrik.bootstrapped){l.removeClass("icon-star-empty").addClass("icon-star")}else{l.src=this.options.insrc}}else{if(Fabrik.bootstrapped){l.addClass("icon-star-empty").removeClass("icon-star")}else{l.src=this.options.insrc}}}.bind(this));document.id("starRatingCover").destroy()}.bind(this)}).send()}});