var FbPicklist=new Class({Extends:FbElement,initialize:function(b,a){this.plugin="fabrikpicklist";this.parent(b,a);if(this.options.allowadd===true){this.watchAddToggle();this.watchAdd()}this.makeSortable()},makeSortable:function(){if(this.options.editable){var g=this.getContainer();var f=g.getElement(".fromList"),e=g.getElement(".toList"),a=f.getStyle("background-color"),b=this;this.sortable=new Sortables([f,e],{clone:true,revert:true,opacity:0.7,hovercolor:"#ffddff",onComplete:function(c){this.setData();this.showNotices(c);b.fadeOut(f,a);b.fadeOut(e,a)}.bind(this),onSort:function(c,h){this.showNotices(c,h)}.bind(this),onStart:function(c,h){this.drag.addEvent("onEnter",function(i,j){if(this.lists.contains(j)){b.fadeOut(j,this.options.hovercolor);if(this.lists.contains(this.drag.overed)){this.drag.overed.addEvent("mouseleave",function(){b.fadeOut(f,a);b.fadeOut(e,a)}.bind(this))}}}.bind(this))}});var d=[f.getElement("li.emptyplicklist"),e.getElement("li.emptyplicklist")];this.sortable.removeItems(d);this.showNotices()}},fadeOut:function(b,a){var c=new Fx.Tween(b,{wait:false,duration:600});c.start("background-color",a)},showNotices:function(b,e){if(b){b=b.getParent("ul")}var f=this.getContainer(),a,g,d;var j=[f.getElement(".fromList"),f.getElement(".toList")];for(d=0;d<j.length;d++){g=j[d];a=(g===b||typeOf(b)==="null")?1:2;var h=g.getElement("li.emptyplicklist");var k=g.getElements("li");k.length>a?h.hide():h.show()}},setData:function(){var e=this.getContainer(),d=e.getElement(".toList"),b=d.getElements("li"),a=b.map(function(f,c){return f.id.replace(this.options.element+"_value_","")}.bind(this));this.element.value=JSON.encode(a)},watchAdd:function(){var e=this.element.id,d=this.getContainer(),b=d.getElement(".toList"),a=d.getElement("input[type=button]");if(typeOf(a)==="null"){return}a.addEvent("click",function(f){var g;value=d.getElement("input[name=addPicklistValue]"),labelEl=d.getElement("input[name=addPicklistLabel]"),label=labelEl.get("value");if(typeOf(value)!=="null"){g=value.value}else{g=label}if(g===""||label===""){alert(Joomla.JText._("PLG_ELEMENT_PICKLIST_ENTER_VALUE_LABEL"))}else{var c=new Element("li",{"class":"picklist",id:this.element.id+"_value_"+g}).set("text",label);b.adopt(c);this.sortable.addItems(c);f.stop();if(typeOf(value)==="element"){value.value=""}labelEl.value="";this.setData();this.addNewOption(g,label);this.showNotices()}}.bind(this))},unclonableProperties:function(){return["form","sortable"]},watchAddToggle:function(){var h=this.getContainer();var f=h.getElement("div.addoption");var b=h.getElement(".toggle-addoption");if(this.mySlider){var g=f.clone();var e=h.getElement(".fabrikElement");f.getParent().destroy();e.adopt(g);f=h.getElement("div.addoption");f.setStyle("margin",0)}this.mySlider=new Fx.Slide(f,{duration:500});this.mySlider.hide();b.addEvent("click",function(a){a.stop();this.mySlider.toggle()}.bind(this))},cloned:function(a){delete this.sortable;if(this.options.allowadd===true){this.watchAddToggle();this.watchAdd()}this.makeSortable();this.parent(a)}});