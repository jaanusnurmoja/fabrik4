var FbPicklist=new Class({Extends:FbElement,initialize:function(c,b){this.plugin="fabrikpicklist";this.parent(c,b);if(this.options.allowadd===true){this.watchAdd()}var f=document.id(this.options.element+"_fromlist");var e=document.id(this.options.element+"_tolist");var a=f.getStyle("background-color");this.sortable=new Sortables([f,e],{clone:true,revert:true,opacity:0.7,hovercolor:"#ffddff",onComplete:function(){this.setData()}.bind(this),onSort:function(g,h){this.showNotices(g,h)}.bind(this),onStart:function(g,h){this.drag.addEvent("onEnter",function(i,j){if(this.lists.contains(j)){var k=new Fx.Tween(j,{wait:false,duration:600});k.start("background-color",this.options.hovercolor);if(this.lists.contains(this.drag.overed)){this.drag.overed.addEvent("mouseleave",function(){var l=new Fx.Tween(j,{wait:false,duration:600});l.start("background-color",a)})}}}.bind(this))}});var d=[f.getElement("li.emptyplicklist"),e.getElement("li.emptyplicklist")];this.sortable.removeItems(d);this.showNotices()},showNotices:function(e,h){if(e){e=e.getParent("ul")}var b,g,d;var a=[this.options.element+"_tolist",this.options.element+"_fromlist"];for(d=0;d<a.length;d++){g=document.id(a[d]);b=(g===e||typeOf(e)==="null")?1:2;var f=g.getElement("li.emptyplicklist");var c=g.getElements("li");c.length>b?f.hide():f.show()}},setData:function(){var c=document.id(this.options.element+"_tolist");var b=c.getElements("li");var a=b.map(function(e,d){return e.id.replace(this.options.element+"_value_","")}.bind(this));this.element.value=JSON.encode(a)},watchAdd:function(){var a=this.element.id;if(!document.id(this.element.id+"_dd_add_entry")){return}document.id(this.element.id+"_dd_add_entry").addEvent("click",function(d){var f;var c=document.id(a+"_ddLabel").value;if(document.id(a+"_ddVal")){f=document.id(a+"_ddVal").value}else{f=c}if(f===""||c===""){alert(Joomla.JText._("PLG_ELEMENT_PICKLIST_ENTER_VALUE_LABEL"))}else{var b=new Element("li",{"class":"picklist",id:this.element.id+"_value_"+f}).set("text",c);document.id(this.element.id+"_tolist").adopt(b);this.sortable.addItems(b);d.stop();if(document.id(a+"_ddVal")){document.id(a+"_ddVal").value=""}document.id(a+"_ddLabel").value="";this.setData();this.addNewOption(f,c)}}.bind(this))}});