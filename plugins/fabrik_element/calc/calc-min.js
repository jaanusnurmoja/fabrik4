/*! Fabrik */
var FbCalc=new Class({Extends:FbElement,initialize:function(a,b){this.plugin="calc",this.oldAjaxCalc=null,this.parent(a,b)},attachedToForm:function(){if(this.options.ajax){{var a;this.form}this.options.observe.each(function(b){""!==b&&(this.form.formElements[b]?this.form.formElements[b].addNewEventAux(this.form.formElements[b].getChangeEvent(),function(a){this.calc(a)}.bind(this)):this.options.canRepeat?(a=b+"_"+this.options.repeatCounter,this.form.formElements[a]&&this.form.formElements[a].addNewEventAux(this.form.formElements[a].getChangeEvent(),function(a){this.calc(a)}.bind(this))):this.form.repeatGroupMarkers.each(function(c,d){for(a="",v2=0;v2<c;v2++)a="join___"+this.form.options.group_join_ids[d]+"___"+b+"_"+v2,this.form.formElements[a]&&this.form.formElements[a].addNewEvent(this.form.formElements[a].getChangeEvent(),function(a){this.calc(a)}.bind(this))}.bind(this)))}.bind(this)),this.options.calcOnLoad&&this.calc()}},calc:function(){var a=this.form.getFormElementData(),b=$H(this.form.getFormData(!1));b.each(function(b,c){(c.test(/^join\[\d+\]/)||c.test(/^fabrik_vars/))&&(a[c]=b)}.bind(this)),$H(a).each(function(b,c){var d=this.form.formElements.get(c);d&&d.options.inRepeatGroup&&d.options.joinid===this.options.joinid&&d.options.repeatCounter===this.options.repeatCounter&&(a[d.options.fullName]=b,a[d.options.fullName+"_raw"]=a[c+"_raw"])}.bind(this));var c={option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",plugin:"calc",method:"ajax_calc",element_id:this.options.id,formid:this.form.id};c=Object.append(a,c),Fabrik.loader.start(this.element.getParent(),Joomla.JText._("COM_FABRIK_LOADING"));new Request({url:"",method:"post",data:c,onComplete:function(a){Fabrik.loader.stop(this.element.getParent()),this.update(a),this.options.validations&&this.form.doElementValidation(this.options.element),this.element.fireEvent("change",new Event.Mock(this.element,"change")),Fabrik.fireEvent("fabrik.calc.update",[this,a])}.bind(this)}).send()},cloned:function(a){this.parent(a),this.attachedToForm()},update:function(a){this.getElement()&&(this.element.innerHTML=a,this.options.value=a)},getValue:function(){return this.element?this.options.value:!1}});