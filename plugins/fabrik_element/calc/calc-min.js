/*! Fabrik */
var FbCalc=new Class({Extends:FbElement,initialize:function(a,b){this.setPlugin("calc"),this.parent(a,b)},attachedToForm:function(){this.options.ajax&&(this.options.observe.each(function(a){this.addObserveEvent(a)}.bind(this)),this.options.calcOnLoad&&this.calc(),Fabrik.addEvent("fabrik.cdd.update",function(a){a.hasSubElements()&&-1!==jQuery.inArray(a.baseElementId,this.options.observe)&&this.addObserveEvent(a.baseElementId)}.bind(this)))},addObserveEvent:function(a){var b;""!==a&&(this.form.formElements[a]?this.form.formElements[a].addNewEventAux(this.form.formElements[a].getChangeEvent(),function(a){this.calc(a)}.bind(this)):this.options.canRepeat?(b=a+"_"+this.options.repeatCounter,this.form.formElements[b]&&this.form.formElements[b].addNewEventAux(this.form.formElements[b].getChangeEvent(),function(a){this.calc(a)}.bind(this))):this.form.repeatGroupMarkers.each(function(c,d){for(b="",v2=0;v2<c;v2++)b="join___"+this.form.options.group_join_ids[d]+"___"+a+"_"+v2,this.form.formElements[b]&&this.form.formElements[b].addNewEvent(this.form.formElements[b].getChangeEvent(),function(a){this.calc(a)}.bind(this))}.bind(this)))},calc:function(){var a=this.form.getFormElementData(),b=$H(this.form.getFormData(!1));b.each(function(b,c){(c.test(/^join\[\d+\]/)||c.test(/^fabrik_vars/))&&(a[c]=b)}.bind(this)),$H(a).each(function(b,c){var d=this.form.formElements.get(c);d&&d.options.inRepeatGroup&&d.options.joinid===this.options.joinid&&d.options.repeatCounter===this.options.repeatCounter&&(a[d.options.fullName]=b,a[d.options.fullName+"_raw"]=a[c+"_raw"])}.bind(this));var c={option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",plugin:"calc",method:"ajax_calc",element_id:this.options.id,formid:this.form.id};c=Object.append(a,c),Fabrik.loader.start(this.element.getParent(),Joomla.JText._("COM_FABRIK_LOADING")),new Request({url:"",method:"post",data:c,onComplete:function(a){Fabrik.loader.stop(this.element.getParent()),this.update(a),this.options.validations&&this.form.doElementValidation(this.options.element),this.element.fireEvent("change",new Event.Mock(this.element,"change")),Fabrik.fireEvent("fabrik.calc.update",[this,a])}.bind(this)}).send()},cloned:function(a){this.parent(a),this.attachedToForm()},update:function(a){this.getElement()&&(this.element.innerHTML=a,this.options.value=a)},getValue:function(){return this.element?this.options.value:!1}});