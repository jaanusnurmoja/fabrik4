/*! Fabrik */
var FbDropdown=new Class({Extends:FbElement,initialize:function(a,b){this.setPlugin("fabrikdropdown"),this.parent(a,b),this.options.allowadd===!0&&this.options.editable!==!1&&(this.watchAddToggle(),this.watchAdd())},watchAddToggle:function(){var a=this.getContainer(),b=a.getElement("div.addoption"),c=a.getElement(".toggle-addoption");if(this.mySlider){var d=b.clone(),e=a.getElement(".fabrikElement");b.getParent().destroy(),e.adopt(d),b=a.getElement("div.addoption"),b.setStyle("margin",0);var f=b.getElement("input[name*=_additions]");f.id=this.element.id+"_additions",f.name=this.element.id+"_additions"}this.mySlider=new Fx.Slide(b,{duration:500}),this.mySlider.hide(),c.addEvent("click",function(a){a.stop(),this.mySlider.toggle()}.bind(this))},addClick:function(a){var b=this.getContainer(),c=b.getElement("input[name=addPicklistLabel]"),d=b.getElement("input[name=addPicklistValue]"),e=c.value;if(val=d?d.value:e,""===val||""===e)alert(Joomla.JText._("PLG_ELEMENT_DROPDOWN_ENTER_VALUE_LABEL"));else{{new Element("option",{selected:"selected",value:val}).set("text",e).inject(document.id(this.element.id))}a.stop(),d&&(d.value=""),c.value="",this.addNewOption(val,e),document.id(this.element.id).fireEvent("change",{stop:function(){}}),this.mySlider&&this.mySlider.toggle(),this.options.advanced&&jQuery("#"+this.element.id).trigger("liszt:updated")}},watchAdd:function(){if(this.options.allowadd===!0&&this.options.editable!==!1){var a=(this.element.id,this.getContainer());this.addClickEvent&&a.getElement("input[type=button]").removeEvent("click",this.addClickEvent),this.addClickEvent=this.addClick.bind(this),a.getElement("input[type=button]").addEvent("click",this.addClickEvent)}},getValue:function(){if(!this.options.editable)return this.options.value;if("null"===typeOf(this.element.get("value")))return"";if(this.options.multiple){var a=[];return this.element.getElements("option").each(function(b){b.selected&&a.push(b.value)}),a}return this.element.get("value")},reset:function(){var a=this.options.defaultVal;this.update(a)},update:function(a){var b=[];if("string"===typeOf(a)&&JSON.validate(a)&&(a=JSON.decode(a)),"null"===typeOf(a)&&(a=[]),this.getElement(),"null"!==typeOf(this.element)){if(this.options.element=this.element.id,!this.options.editable){this.element.set("html","");var c=$H(this.options.data);return void a.each(function(a){this.element.innerHTML+=c.get(a)+"<br />"}.bind(this))}b=this.element.getElements("option"),"number"===typeOf(a)&&(a=a.toString());for(var d=0;d<b.length;d++)b[d].selected=-1!==a.indexOf(b[d].value)?!0:!1;this.watchAdd()}},cloned:function(a){this.options.allowadd===!0&&this.options.editable!==!1&&(this.watchAddToggle(),this.watchAdd()),this.parent(a)}});