var FbDropdown=new Class({Extends:FbElement,initialize:function(b,a){this.plugin="fabrikdropdown";this.parent(b,a);if(this.options.allowadd===true&&this.options.editable!==false){this.watchAddToggle();this.watchAdd()}},watchAddToggle:function(){var i=this.getContainer();var g=i.getElement("div.addoption");var b=i.getElement(".toggle-addoption");if(this.mySlider){var h=g.clone();var e=i.getElement(".fabrikElement");g.getParent().destroy();e.adopt(h);g=i.getElement("div.addoption");g.setStyle("margin",0);var f=g.getElement("input[name*=_additions]");f.id=this.element.id+"_additions";f.name=this.element.id+"_additions"}this.mySlider=new Fx.Slide(g,{duration:500});this.mySlider.hide();b.addEvent("click",function(a){a.stop();this.mySlider.toggle()}.bind(this))},addClick:function(g){var h=this.getContainer();var a=h.getElement("input[name=addPicklistLabel]");var b=h.getElement("input[name=addPicklistValue]");var d=a.value;if(b){val=b.value}else{val=d}if(val===""||d===""){alert(Joomla.JText._("PLG_ELEMENT_DROPDOWN_ENTER_VALUE_LABEL"))}else{var f=new Element("option",{selected:"selected",value:val}).set("text",d).inject(document.id(this.element.id));g.stop();if(b){b.value=""}a.value="";this.addNewOption(val,d);document.id(this.element.id).fireEvent("change",{stop:function(){}});if(this.mySlider){this.mySlider.toggle()}if(this.options.advanced){jQuery("#"+this.element.id).trigger("liszt:updated")}}},watchAdd:function(){var a;if(this.options.allowadd===true&&this.options.editable!==false){var d=this.element.id;var b=this.getContainer();if(this.addClickEvent){b.getElement("input[type=button]").removeEvent("click",this.addClickEvent)}this.addClickEvent=this.addClick.bind(this);b.getElement("input[type=button]").addEvent("click",this.addClickEvent)}},getValue:function(){if(!this.options.editable){return this.options.value}if(typeOf(this.element.get("value"))==="null"){return""}if(this.options.multiple){var a=[];this.element.getElements("option").each(function(b){if(b.selected){a.push(b.value)}});return a}return this.element.get("value")},reset:function(){var a=this.options.defaultVal;this.update(a)},update:function(d){var c=[];if((typeOf(d)==="string")&&(JSON.validate(d))){d=JSON.decode(d)}if(typeOf(d)==="null"){d=[]}this.getElement();if(typeOf(this.element)==="null"){return}this.options.element=this.element.id;if(!this.options.editable){this.element.set("html","");var b=$H(this.options.data);d.each(function(e){this.element.innerHTML+=b.get(e)+"<br />"}.bind(this));return}c=this.element.getElements("option");if(typeOf(d)==="number"){d=d.toString()}for(var a=0;a<c.length;a++){if(d.indexOf(c[a].value)!==-1){c[a].selected=true}else{c[a].selected=false}}this.watchAdd()},cloned:function(a){if(this.options.allowadd===true&&this.options.editable!==false){this.watchAddToggle();this.watchAdd()}this.parent(a)}});