/*! fabrik */
var FbDropdown=new Class({Extends:FbElement,initialize:function(a,b){this.plugin="fabrikdropdown",this.parent(a,b),this.options.allowadd===!0&&this.options.editable!==!1&&(this.watchAddToggle(),this.watchAdd())},watchAddToggle:function(){var a=this.getContainer(),b=a.getElement("div.addoption"),c=a.getElement(".toggle-addoption");if(this.mySlider){var d=b.clone(),e=a.getElement(".fabrikElement");b.getParent().destroy(),e.adopt(d),b=a.getElement("div.addoption"),b.setStyle("margin",0)}this.mySlider=new Fx.Slide(b,{duration:500}),this.mySlider.hide(),c.addEvent("click",function(a){a.stop(),this.mySlider.toggle()}.bind(this))},watchAdd:function(){var a;if(this.options.allowadd===!0&&this.options.editable!==!1){var b=(this.element.id,this.getContainer());b.getElement("input[type=button]").addEvent("click",function(c){var d=b.getElement("input[name=addPicklistLabel]"),e=b.getElement("input[name=addPicklistValue]"),f=d.value;if(a=e?e.value:f,""===a||""===f)alert(Joomla.JText._("PLG_ELEMENT_DROPDOWN_ENTER_VALUE_LABEL"));else{{new Element("option",{selected:"selected",value:a}).set("text",f).inject(document.id(this.element.id))}c.stop(),e&&(e.value=""),d.value="",this.addNewOption(a,f),document.id(this.element.id).fireEvent("change",{stop:function(){}}),this.mySlider&&this.mySlider.toggle(),this.options.advanced&&jQuery("#"+this.element.id).trigger("liszt:updated")}}.bind(this))}},getValue:function(){if(!this.options.editable)return this.options.value;if("null"===typeOf(this.element.get("value")))return"";if(this.options.multiple){var a=[];return this.element.getElements("option").each(function(b){b.selected&&a.push(b.value)}),a}return this.element.get("value")},reset:function(){var a=this.options.defaultVal;this.update(a)},update:function(a){var b=[];if("string"===typeOf(a)&&JSON.validate(a)&&(a=JSON.decode(a)),"null"===typeOf(a)&&(a=[]),this.getElement(),"null"!==typeOf(this.element)){if(this.options.element=this.element.id,!this.options.editable){this.element.set("html","");var c=$H(this.options.data);return void a.each(function(a){this.element.innerHTML+=c.get(a)+"<br />"}.bind(this))}b=this.element.getElements("option"),"number"===typeOf(a)&&(a=a.toString());for(var d=0;d<b.length;d++)b[d].selected=-1!==a.indexOf(b[d].value)?!0:!1;this.watchAdd()}},cloned:function(a){this.options.allowadd===!0&&this.options.editable!==!1&&(this.watchAddToggle(),this.watchAdd()),this.parent(a)}});