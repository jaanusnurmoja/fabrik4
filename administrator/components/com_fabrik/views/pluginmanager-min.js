/*! Fabrik */
var PluginManager=new Class({pluginTotal:0,topTotal:-1,initialize:function(a,b,c){"string"===typeOf(a)&&(a=[a]),this.id=b,this.plugins=a,this.type=c,window.addEvent("domready",function(){var b;for(this.accordion=new Fx.Accordion([],[],{alwaysHide:!0,display:-1,duration:"short"}),b=0;b<a.length;b++)this.addTop(a[b]);this.periodical=this.iniAccordion.periodical(250,this),this.watchPluginSelect(),this.watchDelete(),this.watchAdd();var c=document.id("plugins");"null"!==typeOf(c)&&(c.addEvent("click:relay(h3.title)",function(a,b){document.id("plugins").getElements("h3.title").each(function(a){a!==b&&a.removeClass("pane-toggler-down")}),b.toggleClass("pane-toggler-down")}),this.watchDescriptions(c))}.bind(this))},watchDescriptions:function(a){a.addEvent("keyup:relay(input[name*=plugin_description])",function(a,b){var c=b.getParent(".actionContainer"),d=c.getElement(".pluginTitle"),e=c.getElement("select[name*=plugin]").getValue(),f=b.getValue();d.set("text",e+": "+f)})},iniAccordion:function(){this.pluginTotal===this.plugins.length&&(this.accordion.display(1===this.plugins.length?0:-1),clearInterval(this.periodical))},canSaveForm:function(){return"complete"!==document.readyState?!1:Fabrik.requestQueue.empty()},watchDelete:function(){document.id("adminForm").addEvent("click:relay(a.removeButton, a[data-button=removeButton])",function(a){a.preventDefault(),this.pluginTotal--,this.topTotal--,this.deletePlugin(a)}.bind(this))},watchAdd:function(){var a=document.id("addPlugin");"null"!==typeOf(a)&&a.addEvent("click",function(a){a.stop(),this.accordion.display(-1),this.addTop()}.bind(this))},addTop:function(a){var b,c,d,e,f;"string"===typeOf(a)?(b=1,c=!1,f=!1,a=a?a:"",d="",e=""):(b=a?a.published:1,c=a?a.show_icon:1,f=a?a.must_validate:0,d=a?a.validate_in:"both",e=a?a.validation_on:"both",a=a?a.plugin:"");var g=new Element("div.actionContainer.panel.accordion-group"),h=new Element("a.accordion-toggle",{href:"#"});h.adopt(new Element("span.pluginTitle").set("text",""!==a?a+" "+Joomla.JText._("COM_FABRIK_LOADING").toLowerCase():Joomla.JText._("COM_FABRIK_LOADING")));var i=new Element("div.title.pane-toggler.accordion-heading").adopt(new Element("strong").adopt(h)),j=new Element("div.accordion-body");g.adopt(i),g.adopt(j),g.inject(document.id("plugins")),this.accordion.addSection(i,j);var k=this.topTotal+1,l={option:"com_fabrik",view:"plugin",task:"top",format:"raw",type:this.type,plugin:a,plugin_published:b,show_icon:c,must_validate:f,validate_in:d,validation_on:e,c:this.topTotal,id:this.id},m=new Request.HTML({url:"index.php",data:l,update:j,onRequest:function(){Fabrik.debug&&fconsole("Fabrik pluginmanager: Adding",this.type,"entry",k.toString())}.bind(this),onSuccess:function(){""!==a?this.addPlugin(a,k):i.getElement("span.pluginTitle").set("text",Joomla.JText._("COM_FABRIK_PLEASE_SELECT")),this.updateBootStrap(),FabrikAdmin.reTip()}.bind(this),onFailure:function(a){fconsole("Fabrik pluginmanager addTop ajax failed:",a)},onException:function(a,b){fconsole("Fabrik pluginmanager addTop ajax exception:",a,b)}});this.topTotal++,Fabrik.requestQueue.add(m)},updateBootStrap:function(){document.getElements(".radio.btn-group label").addClass("btn"),document.getElements(".btn-group input[checked=checked]").each(function(a){document.getElement("label[for="+a.get("id")+"]").addClass(""===a.get("value")?"active btn-primary":"0"===a.get("value")?"active btn-danger":"active btn-success"),"undefined"!=typeof jQuery&&jQuery("*[rel=tooltip]").tooltip()}),document.getElements(".hasTip").each(function(a){var b=a.get("title");if(b){var c=b.split("::",2);a.store("tip:title",c[0]),a.store("tip:text",c[1])}});new Tips($$(".hasTip"),{maxTitleChars:50,fixed:!1})},watchPluginSelect:function(){document.id("adminForm").addEvent("change:relay(select.elementtype)",function(a,b){a.preventDefault();var c=b.get("value"),d=b.getParent(".pluginContainer"),e=""!==c?c+" "+Joomla.JText._("COM_FABRIK_LOADING").toLowerCase():Joomla.JText._("COM_FABRIK_PLEASE_SELECT");b.getParent(".actionContainer").getElement("span.pluginTitle").set("text",e);var f=d.id.replace("formAction_","").toInt();this.addPlugin(c,f)}.bind(this))},addPlugin:function(a,b){if(b="number"===typeOf(b)?b:this.pluginTotal,""===a)return void document.id("plugins").getElements(".actionContainer")[b].getElement(".pluginOpts").empty();var c=new Request.HTML({url:"index.php",data:{option:"com_fabrik",view:"plugin",format:"raw",type:this.type,plugin:a,c:b,id:this.id},update:document.id("plugins").getElements(".actionContainer")[b].getElement(".pluginOpts"),onRequest:function(){Fabrik.debug&&fconsole("Fabrik pluginmanager: Loading",this.type,"type",a,"for entry",b.toString())}.bind(this),onSuccess:function(){var c=document.id("plugins").getElements(".actionContainer")[b],d=c.getElement("span.pluginTitle"),e=a,f=c.getElement("input[name*=plugin_description]");f&&(e+=": "+f.getValue()),d.set("text",e),this.pluginTotal++,this.updateBootStrap(),FabrikAdmin.reTip()}.bind(this),onFailure:function(a){fconsole("Fabrik pluginmanager addPlugin ajax failed:",a)},onException:function(a,b){fconsole("Fabrik pluginmanager addPlugin ajax exception:",a,b)}});Fabrik.requestQueue.add(c)},deletePlugin:function(a){var b=a.target.getParent("fieldset.pluginContainer");if("null"!==typeOf(b)){if(Fabrik.debug&&fconsole("Fabrik pluginmanager: Deleting",this.type,"entry",b.id,"and renaming later entries"),b.id.match(/_\d+$/)){var c=b.id.match(/_(\d+)$/)[1].toInt();document.id("plugins").getElements("input, select, textarea, label, fieldset").each(function(a){var b=a.name?a.name.match(/\[(\d+)\]/):null;if(!b&&a.id&&(b=a.id.match(/-(\d+)/)),!b&&"label"===a.get("tag").toLowerCase()&&a.get("for")&&(b=a.get("for").match(/-(\d+)/)),b){var d=b[1].toInt();d>c&&(d--,a.name&&(a.name=a.name.replace(/(\[)(\d+)(\])/,"["+d+"]")),a.id&&(a.id=a.id.replace(/(-)(\d+)/,"-"+d)),"label"===a.get("tag").toLowerCase()&&a.get("for")&&a.set("for",a.get("for").replace(/(-)(\d+)/,"-"+d)))}}),document.id("plugins").getElements("fieldset.pluginContainer").each(function(a){if(a.id.match(/formAction_\d+$/)){var b=a.id.match(/formAction_(\d+)$/)[1].toInt();b>c&&(b-=1,a.id=a.id.replace(/(formAction_)(\d+)$/,"$1"+b))}})}a.stop(),a.target.getParent(".actionContainer").dispose()}}});fabrikAdminPlugin=new Class({Implements:[Options],options:{},initialize:function(a,b,c){this.name=a,this.label=b,this.setOptions(c)},cloned:function(){}});