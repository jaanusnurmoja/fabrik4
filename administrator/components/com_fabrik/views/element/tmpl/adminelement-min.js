var pluginControllers=[];var fabrikAdminElement=new Class({Extends:PluginManager,Implements:[Options,Events],options:{id:0,parentid:0,jsevents:[],deleteButton:"removeButton"},initialize:function(a,b,c){this.parent(a,c,"validationrule");this.setOptions(b);this.setParentViz();this.jsCounter=-1;if(typeOf(document.id("addJavascript"))===false){fconsole("add js button not found")}else{document.id("addJavascript").addEvent("click",function(d){d.stop();this.addJavascript()}.bind(this))}this.options.jsevents.each(function(d){this.addJavascript(d)}.bind(this));document.id("jform_plugin").addEvent("change",function(d){this.changePlugin(d)}.bind(this));document.id("javascriptActions").addEvent("click:relay(a[data-button=removeButton])",function(f,d){f.stop();this.deleteJS(d)}.bind(this))},changePlugin:function(b){document.id("plugin-container").empty().adopt(new Element("span").set("text","Loading...."));var a=new Request({url:"index.php",evalResponse:false,evalScripts:function(c,d){this.script=c}.bind(this),data:{option:"com_fabrik",id:this.options.id,task:"element.getPluginHTML",format:"raw",plugin:b.target.get("value")},update:document.id("plugin-container"),onComplete:function(c){document.id("plugin-container").set("html",c);Browser.exec(this.script);this.updateBootStrap();FabrikAdmin.reTip()}.bind(this)});Fabrik.requestQueue.add(a)},deleteJS:function(a){a.getParent("fieldset").dispose();this.jsCounter--},addJavascript:function(b){var a=b&&b.id?b.id:0;var c=new Request.HTML({url:"index.php",data:{option:"com_fabrik",view:"plugin",task:"top",format:"raw",type:"elementjavascript",plugin:null,plugin_published:true,c:this.jsCounter,id:a,elementid:this.id},append:document.id("javascriptActions"),onSuccess:function(d){this.updateBootStrap();FabrikAdmin.reTip()}.bind(this),onFailure:function(d){console.log("fail",d)},onException:function(e,d){console.log("exception",e,d)}});Fabrik.requestQueue.add(c);this.updateBootStrap();FabrikAdmin.reTip();this.jsCounter++},setParentViz:function(){if(this.options.parentid.toInt()!==0){myFX=new Fx.Tween("elementFormTable",{property:"opacity",duration:500,wait:false}).set(0);document.id("unlink").addEvent("click",function(b){var a=(this.checked)?"":"readonly";if(this.checked){myFX.start(0,1)}else{myFX.start(1,0)}})}if(document.id("swapToParent")){document.id("swapToParent").addEvent("click",function(b){var a=document.adminForm;a.task.value="element.parentredirect";var c=b.target.className.replace("element_","");a.redirectto.value=c;a.submit()})}}});